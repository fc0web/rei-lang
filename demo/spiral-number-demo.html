<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rei â€” èºæ—‹æ•°ä½“ç³» Ï„Â²=-1+Îµ ãƒ‡ãƒ¢</title>
<style>
  :root{--bg:#080810;--sf:#10101a;--bd:#252535;--tx:#c0c0d0;--ac:#4fd1c5;--ac2:#7b68ee;--dim:#555570;--ok:#48bb78;--warn:#f6ad55;--err:#fc8181}
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:var(--tx);font-family:'Courier New',monospace;min-height:100vh}
  .container{max-width:1200px;margin:0 auto;padding:20px}
  header{text-align:center;padding:40px 20px 30px;border-bottom:1px solid var(--bd);margin-bottom:30px}
  header h1{font-size:2em;color:var(--ac);text-shadow:0 0 20px rgba(79,209,197,.3);margin-bottom:8px}
  header p{color:var(--dim);font-size:.95em}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  @media(max-width:800px){.grid{grid-template-columns:1fr}}
  .panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:20px}
  .panel h2{color:var(--ac2);font-size:1.1em;margin-bottom:15px;padding-bottom:8px;border-bottom:1px solid var(--bd)}
  .row{display:flex;gap:10px;align-items:center;margin-bottom:8px}
  .row label{min-width:60px;color:var(--dim);font-size:.85em}
  input[type=range]{flex:1;accent-color:var(--ac)}
  .val{min-width:60px;text-align:right;font-size:.85em;color:var(--ac)}
  canvas{width:100%;height:350px;background:var(--bg);border:1px solid var(--bd);border-radius:4px;margin-top:10px}
  .result{margin-top:12px;padding:12px;background:var(--bg);border-radius:4px;font-size:.82em;line-height:1.6;max-height:220px;overflow-y:auto}
  .badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:.8em;font-weight:bold}
  .badge-e{background:rgba(79,209,197,.15);color:var(--ac)}
  .badge-p{background:rgba(246,173,85,.15);color:var(--warn)}
  .badge-h{background:rgba(252,129,129,.15);color:var(--err)}
  .cmp{margin-top:20px}
  .cmp table{width:100%;border-collapse:collapse;font-size:.82em}
  .cmp th,.cmp td{padding:6px 8px;border:1px solid var(--bd);text-align:right}
  .cmp th{background:var(--sf);color:var(--ac2);text-align:left}
  footer{text-align:center;padding:30px;color:var(--dim);font-size:.8em;border-top:1px solid var(--bd);margin-top:40px}
</style>
</head>
<body>
<div class="container">
<header>
  <h1>ğŸŒ€ èºæ—‹æ•°ä½“ç³» â€” Ï„Â² = -1 + Îµ</h1>
  <p>Rei 0â‚€å¼ | Spiral Number System â€” è¤‡ç´ æ•°ãƒ»åŒå¯¾æ•°ãƒ»åˆ†è§£å‹è¤‡ç´ æ•°ã®é€£ç¶šçš„çµ±ä¸€</p>
</header>
<div class="grid">
  <div class="panel">
    <h2>ğŸ”§ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</h2>
    <div class="row"><label>r:</label><input type="range" id="r" min="0.1" max="5" step="0.1" value="1"><span class="val" id="rV">1.0</span></div>
    <div class="row"><label>Î¸:</label><input type="range" id="th" min="0" max="6.28" step="0.01" value="0"><span class="val" id="thV">0.00</span></div>
    <div class="row"><label>s:</label><input type="range" id="s" min="-3" max="3" step="0.05" value="1"><span class="val" id="sV">1.00</span></div>
    <div class="row"><label>Îµ:</label><input type="range" id="eps" min="-1" max="3" step="0.01" value="0"><span class="val" id="epsV">0.00</span></div>
    <div class="row"><label>å›è»¢æ•°:</label><input type="range" id="turns" min="1" max="8" step="1" value="3"><span class="val" id="turnsV">3</span></div>
    <div class="result" id="info"><span style="color:var(--dim)">â† ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã™ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°</span></div>
  </div>
  <div class="panel">
    <h2>ğŸ“Š 3Dèºæ—‹è»Œé“</h2>
    <canvas id="cv"></canvas>
  </div>
</div>
<div class="panel cmp" style="margin-top:20px">
  <h2>ğŸ”¬ æ—¢å­˜ä½“ç³»ã¨ã®æ¯”è¼ƒ</h2>
  <table id="cmpTable">
    <tr><th>ä½“ç³»</th><th>x</th><th>y</th><th>z</th><th>å·®ç•°Î”</th></tr>
    <tr id="rowSpiral"><td>èºæ—‹ (Ï„Â²=-1+Îµ)</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
    <tr id="rowComplex"><td>è¤‡ç´  (iÂ²=-1)</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
    <tr id="rowDual"><td>åŒå¯¾ (ÎµÂ²=0)</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
    <tr id="rowSplit"><td>åˆ†è§£å‹ (jÂ²=+1)</td><td>â€”</td><td>â€”</td><td>â€”</td><td>â€”</td></tr>
  </table>
</div>
<footer>Rei 0â‚€å¼ â€” D-FUMT / Nobuki Fujimoto | èºæ—‹æ•°ä½“ç³»: Ï„Â² = -1 + Îµ</footer>
</div>
<script>
// === èºæ—‹æ•°ã‚¨ãƒ³ã‚¸ãƒ³ ===
function AB(s,e){
  const T=1e-9;
  if(e<1-T){const w=Math.sqrt(1-e);return{A:Math.cos(w*s),B:w>T?Math.sin(w*s)/w:s}}
  if(e>1+T){const k=Math.sqrt(e-1);return{A:Math.cosh(k*s),B:k>T?Math.sinh(k*s)/k:s}}
  return{A:1,B:s};
}
function region(e){return e<1-1e-9?'elliptic':e>1+1e-9?'hyperbolic':'parabolic'}
function spiral(r,th,s,e){const{A,B}=AB(s,e);return{x:r*A*Math.cos(th),y:r*A*Math.sin(th),z:r*B,region:region(e)}}
function compare(r,th,s,e){
  const sp=spiral(r,th,s,e);
  const cx={x:r*Math.cos(th),y:r*Math.sin(th),z:0};
  const du={x:r*Math.cos(th),y:r*Math.sin(th),z:r*s};
  const{A:sA,B:sB}=AB(s,2);
  const sl={x:r*sA*Math.cos(th),y:r*sA*Math.sin(th),z:r*sB};
  const d=(a,b)=>Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2+(a.z-b.z)**2);
  return{sp,cx,du,sl,dc:d(sp,cx),dd:d(sp,du),ds:d(sp,sl)};
}
// === æç”» ===
const $=id=>document.getElementById(id);
const sliders=['r','th','s','eps','turns'];
const valEls=['rV','thV','sV','epsV','turnsV'];
function getP(){return{r:+$('r').value,th:+$('th').value,s:+$('s').value,eps:+$('eps').value,turns:+$('turns').value}}
function update(){
  const p=getP();
  $('rV').textContent=p.r.toFixed(1);
  $('thV').textContent=p.th.toFixed(2);
  $('sV').textContent=p.s.toFixed(2);
  $('epsV').textContent=p.eps.toFixed(2);
  $('turnsV').textContent=p.turns;
  const sp=spiral(p.r,p.th,p.s,p.eps);
  const reg=sp.region;
  const badge=reg==='elliptic'?'badge-e':reg==='parabolic'?'badge-p':'badge-h';
  const{A,B}=AB(p.s,p.eps);
  $('info').innerHTML=`
    <div><strong>é ˜åŸŸ:</strong> <span class="badge ${badge}">${reg}</span></div>
    <div><strong>(x, y, z):</strong> (${sp.x.toFixed(6)}, ${sp.y.toFixed(6)}, ${sp.z.toFixed(6)})</div>
    <div><strong>A(s):</strong> ${A.toFixed(6)} <strong>B(s):</strong> ${B.toFixed(6)}</div>
    <div><strong>|z|:</strong> ${Math.sqrt(sp.x**2+sp.y**2+sp.z**2).toFixed(6)}</div>
    <div><strong>Ï„Â²:</strong> ${(-1+p.eps).toFixed(4)} (Îµ=${p.eps.toFixed(2)})</div>
    <div style="margin-top:6px;color:var(--dim)">${
      reg==='elliptic'?'å‘¨æœŸçš„æŒ¯å‹• â€” cos/sinåŸºåº• â€” Ï‰=âˆš(1-Îµ)='+Math.sqrt(Math.max(0,1-p.eps)).toFixed(4):
      reg==='parabolic'?'è‡¨ç•Œç‚¹ â€” ç·šå½¢åŸºåº• â€” A=1, B=s':
      'æŒ‡æ•°çš„æ‹¡æ•£ â€” cosh/sinhåŸºåº• â€” Îº=âˆš(Îµ-1)='+Math.sqrt(Math.max(0,p.eps-1)).toFixed(4)
    }</div>`;
  // æ¯”è¼ƒãƒ†ãƒ¼ãƒ–ãƒ«
  const c=compare(p.r,p.th,p.s,p.eps);
  const fmt=v=>v.toFixed(4);
  const fmtD=v=>v<1e-10?'<span style="color:var(--ok)">â‰¡ä¸€è‡´</span>':v.toFixed(4);
  $('rowSpiral').innerHTML=`<td>èºæ—‹ (Ï„Â²=${(-1+p.eps).toFixed(2)})</td><td>${fmt(c.sp.x)}</td><td>${fmt(c.sp.y)}</td><td>${fmt(c.sp.z)}</td><td>â€”</td>`;
  $('rowComplex').innerHTML=`<td>è¤‡ç´  (iÂ²=-1)</td><td>${fmt(c.cx.x)}</td><td>${fmt(c.cx.y)}</td><td>${fmt(c.cx.z)}</td><td>${fmtD(c.dc)}</td>`;
  $('rowDual').innerHTML=`<td>åŒå¯¾ (ÎµÂ²=0)</td><td>${fmt(c.du.x)}</td><td>${fmt(c.du.y)}</td><td>${fmt(c.du.z)}</td><td>${fmtD(c.dd)}</td>`;
  $('rowSplit').innerHTML=`<td>åˆ†è§£å‹ (jÂ²=+1)</td><td>${fmt(c.sl.x)}</td><td>${fmt(c.sl.y)}</td><td>${fmt(c.sl.z)}</td><td>${fmtD(c.ds)}</td>`;
  draw(p);
}
function draw(p){
  const cv=$('cv'),ctx=cv.getContext('2d'),dpr=devicePixelRatio||1;
  cv.width=cv.clientWidth*dpr;cv.height=cv.clientHeight*dpr;ctx.scale(dpr,dpr);
  const W=cv.clientWidth,H=cv.clientHeight;
  ctx.fillStyle='#080810';ctx.fillRect(0,0,W,H);
  // è»Œé“ç”Ÿæˆ
  const N=p.turns*60;const pts=[];
  for(let i=0;i<=N;i++){
    const t=i/N*p.turns*2*Math.PI;
    const th=p.th+t;const s=p.s*(t/(p.turns*2*Math.PI));
    const pt=spiral(p.r,th,s,p.eps);pts.push(pt);
  }
  // ç°¡æ˜“3Då°„å½±ï¼ˆç­‰è§’å°„å½±ï¼‰
  const angle=0.6,ca=Math.cos(angle),sa=Math.sin(angle);
  const proj=(pt)=>({
    px:W/2+(pt.x*ca-pt.y*sa)*60,
    py:H/2-(pt.z*60-pt.y*ca*20-pt.x*sa*20)*0.7
  });
  // ã‚°ãƒªãƒƒãƒ‰
  ctx.strokeStyle='#151525';ctx.lineWidth=.5;
  for(let i=-5;i<=5;i++){
    const a=proj({x:i,y:-5,z:0}),b=proj({x:i,y:5,z:0});
    ctx.beginPath();ctx.moveTo(a.px,a.py);ctx.lineTo(b.px,b.py);ctx.stroke();
    const c=proj({x:-5,y:i,z:0}),d=proj({x:5,y:i,z:0});
    ctx.beginPath();ctx.moveTo(c.px,c.py);ctx.lineTo(d.px,d.py);ctx.stroke();
  }
  // åŸç‚¹
  const o=proj({x:0,y:0,z:0});
  ctx.fillStyle='rgba(255,255,255,.3)';ctx.beginPath();ctx.arc(o.px,o.py,3,0,Math.PI*2);ctx.fill();
  // è»Œé“æç”»
  if(pts.length>1){
    for(let i=1;i<pts.length;i++){
      const t=i/(pts.length-1);
      const a=proj(pts[i-1]),b=proj(pts[i]);
      const reg=region(p.eps);
      const r0=reg==='elliptic'?79:reg==='parabolic'?246:252;
      const g0=reg==='elliptic'?209:reg==='parabolic'?173:129;
      const b0=reg==='elliptic'?197:reg==='parabolic'?85:129;
      ctx.strokeStyle=`rgba(${r0},${g0},${b0},${.3+.7*t})`;
      ctx.lineWidth=1.5;ctx.beginPath();ctx.moveTo(a.px,a.py);ctx.lineTo(b.px,b.py);ctx.stroke();
    }
    // å§‹ç‚¹ãƒ»çµ‚ç‚¹
    const s0=proj(pts[0]),sN=proj(pts[pts.length-1]);
    ctx.fillStyle='#f6ad55';ctx.beginPath();ctx.arc(s0.px,s0.py,5,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#48bb78';ctx.beginPath();ctx.arc(sN.px,sN.py,5,0,Math.PI*2);ctx.fill();
  }
  // ç¾åœ¨ã®ç‚¹
  const cur=spiral(p.r,p.th,p.s,p.eps),cp=proj(cur);
  ctx.fillStyle='#fff';ctx.beginPath();ctx.arc(cp.px,cp.py,6,0,Math.PI*2);ctx.fill();
  ctx.fillStyle=var_color(p.eps);ctx.beginPath();ctx.arc(cp.px,cp.py,4,0,Math.PI*2);ctx.fill();
  // ãƒ©ãƒ™ãƒ«
  ctx.font='10px monospace';ctx.fillStyle='#555570';
  ctx.fillText('x',W-20,H/2);ctx.fillText('z',W/2,20);
}
function var_color(e){return e<1?'#4fd1c5':e>1?'#fc8181':'#f6ad55'}
sliders.forEach(id=>$(id).addEventListener('input',update));
update();
</script>
</body>
</html>
