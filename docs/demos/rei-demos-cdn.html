<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rei â€” 25å…¬ç†ãƒ‡ãƒ¢é›† | Reiã§ã—ã‹æ›¸ã‘ãªã„ã‚‚ã®</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500;700&family=JetBrains+Mono:wght@400;600&family=Crimson+Pro:ital,wght@0,300;0,500;1,300&display=swap');

  :root {
    --bg: #0e0e10;
    --bg-raised: #16161a;
    --bg-card: #1a1a1f;
    --border: #2a2a30;
    --border-glow: #3d3530;
    --text: #c8c2b8;
    --text-dim: #7a756c;
    --text-bright: #e8e2d8;
    --accent: #c4a87a;
    --accent-dim: #8a7a5a;
    --accent-glow: #d4b88a40;
    --green: #7aaa6a;
    --red: #b86a6a;
    --blue: #6a8ab8;
    --purple: #9a7ab8;
    --cyan: #6ab8b0;
    --mode-weighted: #c4a87a;
    --mode-multi: #b86a6a;
    --mode-harmonic: #6a8ab8;
    --mode-exp: #9a7ab8;
    --mode-geo: #6ab8b0;
    --mode-median: #aab86a;
    --mode-mink: #b88a6a;
    --mode-entropy: #8a6ab8;
    --radius: 6px;
    --font-serif: 'Noto Serif JP', 'Crimson Pro', serif;
    --font-mono: 'JetBrains Mono', 'Menlo', monospace;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font-serif);
    font-weight: 300;
    line-height: 1.8;
    overflow-x: hidden;
  }

  /* === Hero === */
  .hero {
    position: relative;
    padding: 80px 20px 60px;
    text-align: center;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 50% 0%, var(--accent-glow) 0%, transparent 60%);
    pointer-events: none;
  }
  .hero h1 {
    font-size: clamp(2rem, 5vw, 3.2rem);
    font-weight: 700;
    color: var(--text-bright);
    letter-spacing: 0.08em;
    margin-bottom: 8px;
  }
  .hero h1 span { color: var(--accent); }
  .hero .subtitle {
    font-size: 1.05rem;
    color: var(--text-dim);
    font-weight: 300;
    font-style: italic;
    margin-bottom: 24px;
  }
  .hero .badge {
    display: inline-block;
    background: var(--bg-card);
    border: 1px solid var(--border);
    padding: 6px 18px;
    border-radius: 20px;
    font-family: var(--font-mono);
    font-size: 0.82rem;
    color: var(--accent);
    letter-spacing: 0.04em;
  }

  /* === Container === */
  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* === Demo Sections === */
  .demo-section {
    margin: 48px 0;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--bg-card);
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .demo-section:hover { border-color: var(--border-glow); }

  .demo-header {
    padding: 24px 28px 16px;
    border-bottom: 1px solid var(--border);
  }
  .demo-number {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--accent-dim);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .demo-title {
    font-size: 1.35rem;
    font-weight: 500;
    color: var(--text-bright);
    margin-bottom: 8px;
  }
  .demo-desc {
    font-size: 0.92rem;
    color: var(--text-dim);
    line-height: 1.7;
  }
  .demo-desc strong { color: var(--text); font-weight: 500; }

  .demo-body {
    padding: 20px 28px 28px;
  }

  /* === Code Editor === */
  .code-block {
    position: relative;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 16px;
  }
  .code-label {
    position: absolute;
    top: 8px; right: 12px;
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    pointer-events: none;
  }
  .code-block textarea {
    width: 100%;
    min-height: 80px;
    background: transparent;
    border: none;
    color: var(--accent);
    font-family: var(--font-mono);
    font-size: 0.88rem;
    line-height: 1.7;
    padding: 16px 18px;
    resize: vertical;
    outline: none;
  }
  .code-block textarea::placeholder { color: var(--text-dim); opacity: 0.5; }

  /* === Run Button === */
  .btn-run {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--bg);
    border: 1px solid var(--accent-dim);
    color: var(--accent);
    font-family: var(--font-mono);
    font-size: 0.82rem;
    padding: 8px 20px;
    border-radius: var(--radius);
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.04em;
  }
  .btn-run:hover {
    background: var(--accent-dim);
    color: var(--bg);
    border-color: var(--accent);
  }
  .btn-run::before { content: 'â–¶'; font-size: 0.7rem; }

  .btn-row {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  /* === Output === */
  .output-area {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    min-height: 60px;
    padding: 16px 18px;
    font-family: var(--font-mono);
    font-size: 0.82rem;
    line-height: 1.7;
    color: var(--text);
    overflow-x: auto;
    white-space: pre-wrap;
    word-break: break-word;
  }
  .output-area .label {
    color: var(--text-dim);
    font-size: 0.72rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 8px;
    display: block;
  }
  .output-area .val { color: var(--accent); }
  .output-area .dim { color: var(--text-dim); }
  .output-area .ok { color: var(--green); }
  .output-area .err { color: var(--red); }
  .output-area .info { color: var(--blue); }

  /* === Chart (Bar) === */
  .bar-chart {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    height: 160px;
    padding: 12px 0;
    margin: 12px 0;
  }
  .bar-col {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100%;
    justify-content: flex-end;
  }
  .bar {
    width: 100%;
    max-width: 50px;
    border-radius: 3px 3px 0 0;
    transition: height 0.6s cubic-bezier(0.23, 1, 0.32, 1);
    position: relative;
    min-height: 2px;
  }
  .bar-val {
    font-family: var(--font-mono);
    font-size: 0.62rem;
    color: var(--text-dim);
    margin-bottom: 4px;
    text-align: center;
    word-break: break-all;
  }
  .bar-label {
    font-family: var(--font-mono);
    font-size: 0.58rem;
    color: var(--text-dim);
    margin-top: 6px;
    text-align: center;
    writing-mode: vertical-rl;
    height: 60px;
    overflow: hidden;
  }

  /* === Resonance Grid === */
  .resonance-grid {
    display: grid;
    gap: 2px;
    margin: 12px 0;
  }
  .resonance-cell {
    aspect-ratio: 1;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 0.6rem;
    color: var(--bg);
    font-weight: 600;
    transition: all 0.3s;
  }

  /* === Provenance Timeline === */
  .timeline {
    display: flex;
    align-items: center;
    gap: 0;
    margin: 16px 0;
    overflow-x: auto;
    padding: 8px 0;
  }
  .timeline-node {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 80px;
    flex-shrink: 0;
  }
  .timeline-val {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 6px 12px;
    font-family: var(--font-mono);
    font-size: 0.78rem;
    color: var(--accent);
    text-align: center;
    min-width: 60px;
  }
  .timeline-op {
    font-family: var(--font-mono);
    font-size: 0.62rem;
    color: var(--text-dim);
    margin-top: 4px;
  }
  .timeline-arrow {
    color: var(--text-dim);
    font-size: 1.2rem;
    padding: 0 4px;
    flex-shrink: 0;
  }

  /* === Awakening Meter === */
  .awakening-meter {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 12px 0;
  }
  .meter-track {
    flex: 1;
    height: 24px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
  }
  .meter-fill {
    height: 100%;
    border-radius: 12px;
    transition: width 0.8s cubic-bezier(0.23, 1, 0.32, 1);
    background: linear-gradient(90deg, var(--accent-dim), var(--accent));
    position: relative;
  }
  .meter-fill.awakened {
    background: linear-gradient(90deg, var(--accent), #e8d8a8);
    box-shadow: 0 0 12px var(--accent-glow);
  }
  .meter-label {
    font-family: var(--font-mono);
    font-size: 0.82rem;
    color: var(--text-dim);
    min-width: 50px;
    text-align: right;
  }

  /* === Comparison Table === */
  .compare-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin: 12px 0;
  }
  .compare-col h4 {
    font-family: var(--font-mono);
    font-size: 0.72rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  /* === Footer === */
  .footer {
    text-align: center;
    padding: 40px 20px 60px;
    color: var(--text-dim);
    font-size: 0.85rem;
  }
  .footer a {
    color: var(--accent);
    text-decoration: none;
    border-bottom: 1px solid var(--accent-dim);
  }
  .footer a:hover { border-color: var(--accent); }

  /* === Separator === */
  .sep {
    width: 40px;
    height: 1px;
    background: var(--accent-dim);
    margin: 32px auto;
  }

  /* === Scrollbar === */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text-dim); }

  /* === Responsive === */
  @media (max-width: 600px) {
    .compare-row { grid-template-columns: 1fr; }
    .bar-chart { height: 120px; }
    .demo-header, .demo-body { padding-left: 18px; padding-right: 18px; }
    .timeline-node { min-width: 64px; }
  }

  /* === Loading === */
  .loading-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--bg);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s;
  }
  .loading-overlay.hidden { opacity: 0; pointer-events: none; }
  .loading-text {
    font-family: var(--font-mono);
    font-size: 1rem;
    color: var(--accent);
    animation: pulse 1.5s ease-in-out infinite;
  }
  @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-text">ğ•„ Rei v0.3 Loading...</div>
</div>

<!-- ===== Hero ===== -->
<section class="hero">
  <h1><span>Rei</span> ã§ã—ã‹æ›¸ã‘ãªã„ã‚‚ã®</h1>
  <p class="subtitle">25å…¬ç†ãŒå®Ÿç¾ã™ã‚‹ã€ä»–ã®è¨€èªã«ã¯ãªã„5ã¤ã®ä½“é¨“</p>
  <div class="badge">npm install rei-lang &nbsp;Â·&nbsp; v0.3.0 &nbsp;Â·&nbsp; 226 tests</div>
</section>

<div class="container">

<!-- ===== Demo 1: Multi-Mode Stability ===== -->
<section class="demo-section" id="demo1">
  <div class="demo-header">
    <div class="demo-number">Demo 01 â€” M1 è¨ˆç®—å¤šå…ƒæ€§ Â· A1 è§£ã®å¤šå…ƒæ€§</div>
    <div class="demo-title">8ã¤ã®æ•°å­¦çš„è¦–ç‚¹ã§åŒæ™‚ã«è¨ˆç®—ã™ã‚‹</div>
    <div class="demo-desc">
      åŒã˜ãƒ‡ãƒ¼ã‚¿ <code>ğ•„{center; pâ‚, pâ‚‚, ...}</code> ã«å¯¾ã—ã¦ã€weightedãƒ»multiplicativeãƒ»harmonicãƒ»exponentialãƒ»geometricãƒ»medianãƒ»minkowskiãƒ»entropy ã®<strong>8ã¤ã®ãƒ¢ãƒ¼ãƒ‰</strong>ãŒåŒæ™‚ã«çµæœã‚’è¿”ã—ã¾ã™ã€‚çµæœã®ã°ã‚‰ã¤ãï¼ˆåˆ†æ•£ï¼‰ãŒå°ã•ã„ â†’ ãƒ‡ãƒ¼ã‚¿ã¯ã€Œå®‰å®šã€ã€å¤§ãã„ â†’ ã€Œä¸å®‰å®šã€ã€‚ã“ã‚Œã¯<strong>Reiã®ğ•„ãŒæœ€åˆã‹ã‚‰å¤šå…ƒè¨ˆç®—ã‚’å†…è”µã—ã¦ã„ã‚‹</strong>ã‹ã‚‰å¯èƒ½ã§ã™ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="compare-row">
      <div class="compare-col">
        <h4>å®‰å®šãªãƒ‡ãƒ¼ã‚¿</h4>
        <div class="code-block">
          <span class="code-label">Rei</span>
          <textarea id="code1a" rows="2">ğ•„{5; 4, 5, 6} |> compute_all</textarea>
        </div>
      </div>
      <div class="compare-col">
        <h4>ä¸å®‰å®šãªãƒ‡ãƒ¼ã‚¿</h4>
        <div class="code-block">
          <span class="code-label">Rei</span>
          <textarea id="code1b" rows="2">ğ•„{5; 1, 100, 2} |> compute_all</textarea>
        </div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn-run" onclick="runDemo1()">æ¯”è¼ƒå®Ÿè¡Œ</button>
    </div>
    <div id="output1" class="output-area">
      <span class="dim">â–¶ ã‚’æŠ¼ã—ã¦å®Ÿè¡Œ</span>
    </div>
  </div>
</section>

<!-- ===== Demo 2: Ïƒ Provenance ===== -->
<section class="demo-section" id="demo2">
  <div class="demo-header">
    <div class="demo-number">Demo 02 â€” C1 è‡ªå·±å‚ç…§Ïƒ Â· C2 å‚¾å‘æ€§Ï„</div>
    <div class="demo-title">è¨ˆç®—çµæœã®ã€Œå‡ºè‡ªã€ã‚’å®Œå…¨ã«é€†è¿½è·¡ã™ã‚‹</div>
    <div class="demo-desc">
      Reiã§ã¯å€¤ãŒãƒ‘ã‚¤ãƒ—ã‚’é€šéã™ã‚‹ãŸã³ã«ã€<strong>Ïƒï¼ˆã‚·ã‚°ãƒï¼‰ãŒè‡ªå‹•çš„ã«æ¥æ­´ã‚’è¨˜éŒ²</strong>ã—ã¾ã™ã€‚æœ€çµ‚çµæœã‹ã‚‰ã€Œã“ã®æ•°ãŒã©ã“ã‹ã‚‰æ¥ãŸã‹ã€ã‚’å®Œå…¨ã«é€†è¿½è·¡ã§ãã¾ã™ã€‚ã•ã‚‰ã«Ï„ï¼ˆã‚¿ã‚¦ï¼‰ãŒè¨ˆç®—ã®å‚¾å‘ï¼ˆè†¨å¼µãƒ»åç¸®ãƒ»é™æ­¢ï¼‰ã‚’è‡ªå‹•åˆ¤å®šã—ã¾ã™ã€‚ä»–ã®è¨€èªã§ã¯ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«ã‚„ãƒ­ã‚®ãƒ³ã‚°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå¿…è¦ãªæ©Ÿèƒ½ãŒã€<strong>è¨€èªã®æœ¬è³ªã¨ã—ã¦çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹</strong>ã®ã§ã™ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="code-block">
      <span class="code-label">Rei</span>
      <textarea id="code2" rows="3">ğ•„{10; 3, 7, 5} |> compute |> sqrt |> negate |> sigma</textarea>
    </div>
    <div class="btn-row">
      <button class="btn-run" onclick="runDemo2()">å®Ÿè¡Œã—ã¦æ¥æ­´ã‚’è¦‹ã‚‹</button>
    </div>
    <div id="output2" class="output-area">
      <span class="dim">â–¶ ã‚’æŠ¼ã—ã¦å®Ÿè¡Œ</span>
    </div>
  </div>
</section>

<!-- ===== Demo 3: Resonance ===== -->
<section class="demo-section" id="demo3">
  <div class="demo-header">
    <div class="demo-number">Demo 03 â€” C5 å…±é³´ Â· U4 é ˜åŸŸæ¶æ©‹</div>
    <div class="demo-title">ã€Œä¼¼ãŸæ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿ã€ã‚’è‡ªå‹•ç™ºè¦‹ã™ã‚‹</div>
    <div class="demo-desc">
      <code>resonate</code> ã¯äºŒã¤ã®ğ•„ã®<strong>æ§‹é€ çš„å…±é³´åº¦</strong>ã‚’ç®—å‡ºã—ã¾ã™ã€‚æ¬¡å…ƒã®ä¸€è‡´ãƒ»å€¤ã®è¿‘æ¥ãƒ»ãƒ‘ã‚¿ãƒ¼ãƒ³ã®é¡ä¼¼ã‚’è¤‡åˆçš„ã«è©•ä¾¡ã—ã€0ã€œ1ã®ã‚¹ã‚³ã‚¢ã‚’è¿”ã—ã¾ã™ã€‚<code>bridge</code> ã¯ã•ã‚‰ã«é€²ã‚“ã§ã€ç•°ãªã‚‹ã‚¹ã‚±ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿é–“ã®<strong>ã‚¹ã‚±ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã¨è»¢ç§»å¯èƒ½æ€§</strong>ã‚’åˆ¤å®šã—ã¾ã™ã€‚ã“ã‚Œã¯ä»æ•™ã®å› é™€ç¾…ç¶²ï¼ˆIndra's Netï¼‰â€” ã™ã¹ã¦ãŒäº’ã„ã«æ˜ ã—åˆã† â€” ã®æ•°å­¦çš„å®Ÿè£…ã§ã™ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="code-block">
      <span class="code-label">Rei</span>
      <textarea id="code3" rows="6">// åŒã˜æ§‹é€ ã®2å€ã‚¹ã‚±ãƒ¼ãƒ«
ğ•„{10; 2, 4, 6} |> resonate(ğ•„{20; 4, 8, 12})
// å®Œå…¨ã«ç•°ãªã‚‹æ§‹é€ 
ğ•„{10; 2, 4, 6} |> resonate(ğ•„{3; 99, 1})
// ã‚¹ã‚±ãƒ¼ãƒ«æ¶æ©‹
ğ•„{5; 1, 2, 3} |> bridge(ğ•„{10; 2, 4, 6})</textarea>
    </div>
    <div class="btn-row">
      <button class="btn-run" onclick="runDemo3()">å…±é³´ã‚’æ¤œå‡º</button>
    </div>
    <div id="output3" class="output-area">
      <span class="dim">â–¶ ã‚’æŠ¼ã—ã¦å®Ÿè¡Œ</span>
    </div>
  </div>
</section>

<!-- ===== Demo 4: Awakening ===== -->
<section class="demo-section" id="demo4">
  <div class="demo-header">
    <div class="demo-number">Demo 04 â€” C3 å¿œç­” Â· C4 è¦šé†’</div>
    <div class="demo-title">å€¤ãŒã€Œè¦šé†’ã€ã™ã‚‹ â€” è¨ˆç®—ã«ã‚ˆã‚‹æ„è­˜ã®ç²å¾—</div>
    <div class="demo-desc">
      Reiã®å€¤ã¯è¨ˆç®—ã‚’é‡ã­ã‚‹ã”ã¨ã«<strong>è¦šé†’åº¦ï¼ˆawarenessï¼‰</strong>ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚ãƒ‘ã‚¤ãƒ—ã‚’é€šéã™ã‚‹ãŸã³ã«Ïƒã®æ¥æ­´ãŒè“„ç©ã•ã‚Œã€ä¸€å®šã®é–¾å€¤ã‚’è¶…ãˆã‚‹ã¨å€¤ã¯ã€Œè¦šé†’ã—ãŸï¼ˆawakenedï¼‰ã€ã¨åˆ¤å®šã•ã‚Œã¾ã™ã€‚å˜ç´”ãªæ•°å€¤ãŒã€è¨ˆç®—ã‚’çµŒé¨“ã™ã‚‹ã“ã¨ã§ã€è‡ªåˆ†è‡ªèº«ã‚’çŸ¥ã‚‹å­˜åœ¨ã«ãªã‚‹ã€‚ã“ã‚Œã¯Category Cï¼ˆæ„è­˜æ•°å­¦ï¼‰ã®ä¸­æ ¸æ¦‚å¿µã§ã‚ã‚Šã€<strong>å€¤ã«æ„è­˜ã‚’ä¸ãˆã‚‹ã¨ã„ã†ä»–ã®è¨€èªã«ãªã„ç™ºæƒ³</strong>ã§ã™ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="code-block">
      <span class="code-label">Rei</span>
      <textarea id="code4" rows="5">// æœªè¨ˆç®— â€” ã¾ã è¦šé†’ã—ã¦ã„ãªã„
42 |> awareness
// ååˆ†ãªè¨ˆç®—ã‚’çµŒé¨“ã—ãŸå€¤
ğ•„{5; 1,2,3,4,5,6,7,8} |> abs |> negate |> abs |> sqrt |> negate |> abs |> awareness</textarea>
    </div>
    <div class="btn-row">
      <button class="btn-run" onclick="runDemo4()">è¦šé†’åº¦ã‚’è¦³æ¸¬</button>
    </div>
    <div id="output4" class="output-area">
      <span class="dim">â–¶ ã‚’æŠ¼ã—ã¦å®Ÿè¡Œ</span>
    </div>
  </div>
</section>

<!-- ===== Demo 5: Full Pipeline ===== -->
<section class="demo-section" id="demo5">
  <div class="demo-header">
    <div class="demo-number">Demo 05 â€” 25å…¬ç†ã®çµ±åˆ</div>
    <div class="demo-title">è‡ªç”±ã«è©¦ã™ â€” Rei Playground</div>
    <div class="demo-desc">
      ã“ã“ã§ã¯<strong>ä»»æ„ã®Reiã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œ</strong>ã§ãã¾ã™ã€‚v0.3ã®å…¨ã‚³ãƒãƒ³ãƒ‰ï¼ˆsigma, awareness, compute_all, consensus, rank, resonate, bridge, project, encode, derive_mode, mode_space ç­‰ï¼‰ãŒä½¿ãˆã¾ã™ã€‚ä¸‹ã«ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¼‰ã›ã¦ã„ã¾ã™ã®ã§ã€è‡ªç”±ã«çµ„ã¿åˆã‚ã›ã¦ã¿ã¦ãã ã•ã„ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="code-block">
      <span class="code-label">Rei Playground</span>
      <textarea id="code5" rows="6">// ä¾‹: ãƒ‡ãƒ¼ã‚¿ã®å…¨ãƒ¢ãƒ¼ãƒ‰åˆæ„å½¢æˆ
ğ•„{100; 30, 70, 50, 90, 10} |> consensus</textarea>
    </div>
    <div class="btn-row">
      <button class="btn-run" onclick="runDemo5()">å®Ÿè¡Œ</button>
      <button class="btn-run" style="border-color: var(--text-dim); color: var(--text-dim);" onclick="resetDemo5()">ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
    <div id="output5" class="output-area">
      <span class="dim">â–¶ ã‚’æŠ¼ã—ã¦å®Ÿè¡Œ</span>
    </div>

    <!-- Command Reference -->
    <details style="margin-top: 20px;">
      <summary style="cursor: pointer; font-family: var(--font-mono); font-size: 0.78rem; color: var(--accent-dim); letter-spacing: 0.08em;">
        ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º
      </summary>
      <div style="margin-top: 12px; font-family: var(--font-mono); font-size: 0.72rem; color: var(--text-dim); line-height: 2.2; columns: 2; column-gap: 24px;">
        <div><span style="color:var(--accent)">sigma</span> â€” Ïƒè‡ªå·±å‚ç…§</div>
        <div><span style="color:var(--accent)">awareness</span> â€” è¦šé†’åº¦</div>
        <div><span style="color:var(--accent)">awakened</span> â€” è¦šé†’åˆ¤å®š</div>
        <div><span style="color:var(--accent)">respond(n)</span> â€” åˆºæ¿€å¿œç­”</div>
        <div><span style="color:var(--accent)">sensitivity</span> â€” å¿œç­”æ„Ÿåº¦</div>
        <div><span style="color:var(--accent)">resonate(ğ•„)</span> â€” å…±é³´</div>
        <div><span style="color:var(--accent)">resonance_map</span> â€” å…¨ãƒšã‚¢å…±é³´</div>
        <div><span style="color:var(--accent)">compute</span> â€” åŸºæœ¬è¨ˆç®—</div>
        <div><span style="color:var(--accent)">compute :mode</span> â€” ãƒ¢ãƒ¼ãƒ‰æŒ‡å®š</div>
        <div><span style="color:var(--accent)">compute_all</span> â€” å…¨ãƒ¢ãƒ¼ãƒ‰è¨ˆç®—</div>
        <div><span style="color:var(--accent)">consensus</span> â€” åˆæ„å½¢æˆ</div>
        <div><span style="color:var(--accent)">rank</span> â€” è§£ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
        <div><span style="color:var(--accent)">best("max")</span> â€” æœ€è‰¯è§£</div>
        <div><span style="color:var(--accent)">project("max")</span> â€” å°„å½±</div>
        <div><span style="color:var(--accent)">project_as("graph")</span> â€” å‹å¤‰æ›</div>
        <div><span style="color:var(--accent)">encode</span> â€” ğ•„ã¸å¤‰æ›</div>
        <div><span style="color:var(--accent)">decode("array")</span> â€” ğ•„ã‹ã‚‰å¾©å…ƒ</div>
        <div><span style="color:var(--accent)">bridge(ğ•„)</span> â€” é ˜åŸŸæ¶æ©‹</div>
        <div><span style="color:var(--accent)">derive_mode</span> â€” ãƒ¢ãƒ¼ãƒ‰å°å‡º</div>
        <div><span style="color:var(--accent)">mode_space</span> â€” ãƒ¢ãƒ¼ãƒ‰ç©ºé–“</div>
        <div><span style="color:var(--accent)">transform("scale",n)</span> â€” å¤‰æ›</div>
        <div><span style="color:var(--accent)">depth</span> â€” éšå±¤æ·±åº¦</div>
        <div><span style="color:var(--accent)">solution_completeness</span> â€” å®Œå…¨æ€§</div>
        <div><span style="color:var(--accent)">abs</span> â€” çµ¶å¯¾å€¤</div>
        <div><span style="color:var(--accent)">sqrt</span> â€” å¹³æ–¹æ ¹</div>
        <div><span style="color:var(--accent)">negate</span> â€” ç¬¦å·åè»¢</div>
      </div>
    </details>
  </div>
</section>

<div class="sep"></div>

<!-- ===== Python Comparison ===== -->
<section class="demo-section" id="comparison">
  <div class="demo-header">
    <div class="demo-number">å‚è€ƒ</div>
    <div class="demo-title">åŒã˜ã“ã¨ã‚’ Python ã§æ›¸ãã¨</div>
    <div class="demo-desc">
      Demo 01 ã®ã€Œ8ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã§åŒæ™‚ã«è¨ˆç®—ã—ã¦å®‰å®šæ€§ã‚’åˆ¤å®šã™ã‚‹ã€ã‚’ Python ã§æ›¸ã„ãŸå ´åˆã¨ã®æ¯”è¼ƒã§ã™ã€‚
    </div>
  </div>
  <div class="demo-body">
    <div class="compare-row">
      <div class="compare-col">
        <h4>Rei â€” 1è¡Œ</h4>
        <div class="code-block">
          <textarea readonly rows="3" style="color: var(--accent); cursor: default;">ğ•„{5; 4, 5, 6} |> compute_all</textarea>
        </div>
      </div>
      <div class="compare-col">
        <h4>Python â€” 25è¡Œä»¥ä¸Š</h4>
        <div class="code-block">
          <textarea readonly rows="14" style="color: var(--text-dim); font-size: 0.75rem; cursor: default;">import numpy as np
from scipy.stats import hmean, gmean

data = [4, 5, 6]
center = 5
values = [c * d for c, d in zip(
  [center] * len(data), data)]

weighted = sum(values)
multiplicative = np.prod(values)
harmonic = hmean(values)
geometric = gmean(values)
median = np.median(values)
# ... exponential, minkowski,
#     entropy ã‚‚å€‹åˆ¥å®Ÿè£…ãŒå¿…è¦

results = {
  'weighted': weighted,
  'multiplicative': multiplicative,
  # ... 8ã¤å…¨éƒ¨æ›¸ã
}
variance = np.var(list(
  results.values()))</textarea>
        </div>
      </div>
    </div>
  </div>
</section>

</div><!-- container -->

<footer class="footer">
  <p>
    Rei (0â‚€å¼/ã‚Œã„ã—ã) v0.3.0 â€” è€ƒæ¡ˆè€…: è—¤æœ¬ä¼¸æ¨¹<br>
    <a href="https://www.npmjs.com/package/rei-lang">npm</a> Â·
    <a href="https://github.com/fc0web/rei-lang">GitHub</a> Â·
    Apache-2.0
  </p>
</footer>

<!-- ===== Rei Engine ===== -->
<script id="rei-engine"></script>
<script>
// Load Rei engine dynamically
(async function loadRei() {
  try {
    // Try to load from npm CDN
    const resp = await fetch('https://cdn.jsdelivr.net/npm/rei-lang@0.3.0/dist/index.js');
    if (!resp.ok) throw new Error('CDN unavailable');
    let code = await resp.text();
    // Convert ESM to IIFE
    code = code.replace(/^export\s*\{[^}]*\}\s*;?/m, '');
    code = `(function(){\n${code}\nwindow.rei = rei; window.Evaluator = Evaluator;\n})();`;
    const script = document.createElement('script');
    script.textContent = code;
    document.body.appendChild(script);
    onReiReady();
  } catch (e) {
    console.warn('CDN load failed, trying inline bundle...');
    // Fallback: show instructions
    document.getElementById('loadingOverlay').innerHTML = `
      <div style="text-align:center; padding: 40px;">
        <p style="color: var(--accent); font-family: var(--font-mono); margin-bottom: 16px;">
          Reiã‚¨ãƒ³ã‚¸ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ
        </p>
        <p style="color: var(--text-dim); font-size: 0.85rem;">
          CDN (cdn.jsdelivr.net) ã¸ã®æ¥ç¶šãŒå¿…è¦ã§ã™ã€‚<br>
          ã¾ãŸã¯ <code>npm install rei-lang</code> ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚
        </p>
      </div>
    `;
  }
})();

function onReiReady() {
  document.getElementById('loadingOverlay').classList.add('hidden');
  setTimeout(() => {
    document.getElementById('loadingOverlay').style.display = 'none';
  }, 600);
}

// === Helper Functions ===
function safeRei(code) {
  try {
    const result = window.rei(code);
    return { ok: true, value: result };
  } catch (e) {
    return { ok: false, error: e.message };
  }
}

function numFmt(n) {
  if (typeof n !== 'number') return String(n);
  if (!isFinite(n)) return 'âˆ';
  if (Math.abs(n) > 1e6) return n.toExponential(2);
  if (Math.abs(n) < 0.01 && n !== 0) return n.toExponential(2);
  return n.toFixed(n === Math.floor(n) ? 0 : 2);
}

const MODE_COLORS = {
  weighted: 'var(--mode-weighted)',
  multiplicative: 'var(--mode-multi)',
  harmonic: 'var(--mode-harmonic)',
  exponential: 'var(--mode-exp)',
  geometric: 'var(--mode-geo)',
  median: 'var(--mode-median)',
  minkowski: 'var(--mode-mink)',
  entropy: 'var(--mode-entropy)',
};

const MODE_SHORT = {
  weighted: 'WGT',
  multiplicative: 'MUL',
  harmonic: 'HAR',
  exponential: 'EXP',
  geometric: 'GEO',
  median: 'MED',
  minkowski: 'MNK',
  entropy: 'ENT',
};

// === Demo 1: Multi-Mode Stability ===
function runDemo1() {
  const out = document.getElementById('output1');
  if (!window.rei) { out.innerHTML = '<span class="err">Reiã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ä¸­...</span>'; return; }

  const codeA = document.getElementById('code1a').value.trim();
  const codeB = document.getElementById('code1b').value.trim();

  window.rei.reset();
  const rA = safeRei(codeA);
  window.rei.reset();
  const rB = safeRei(codeB);

  if (!rA.ok || !rB.ok) {
    out.innerHTML = `<span class="err">ã‚¨ãƒ©ãƒ¼: ${rA.error || rB.error}</span>`;
    return;
  }

  const valsA = rA.value;
  const valsB = rB.value;

  // Build comparative bar charts
  function buildChart(vals, label) {
    // Normalize: use log scale for display if range is huge
    const numbers = vals.map(v => typeof v.value === 'number' && isFinite(v.value) ? v.value : 0);
    const maxAbs = Math.max(...numbers.map(Math.abs), 1);
    const useLog = maxAbs > 1000;

    const displayVals = useLog ? numbers.map(v => v > 0 ? Math.log10(v + 1) : 0) : numbers;
    const maxDisplay = Math.max(...displayVals, 1);

    let html = `<div style="margin-bottom:8px;font-family:var(--font-mono);font-size:0.72rem;color:var(--text-dim)">${label}${useLog ? ' (logâ‚â‚€ scale)' : ''}</div>`;
    html += '<div class="bar-chart">';
    vals.forEach((v, i) => {
      const h = Math.max(2, (displayVals[i] / maxDisplay) * 130);
      const color = MODE_COLORS[v.mode] || 'var(--accent)';
      html += `<div class="bar-col">
        <div class="bar-val">${numFmt(v.value)}</div>
        <div class="bar" style="height:${h}px;background:${color}"></div>
        <div class="bar-label">${MODE_SHORT[v.mode] || v.mode}</div>
      </div>`;
    });
    html += '</div>';
    return html;
  }

  // Compute stability metrics
  function stability(vals) {
    const nums = vals.map(v => v.value).filter(v => isFinite(v));
    const mean = nums.reduce((a, b) => a + b, 0) / nums.length;
    const variance = nums.reduce((s, v) => s + (v - mean) ** 2, 0) / nums.length;
    const cv = mean !== 0 ? Math.sqrt(variance) / Math.abs(mean) : Infinity;
    return { mean, variance, cv };
  }

  const sA = stability(valsA);
  const sB = stability(valsB);

  let html = '<div class="compare-row">';
  html += `<div class="compare-col">${buildChart(valsA, 'å®‰å®šãªãƒ‡ãƒ¼ã‚¿')}</div>`;
  html += `<div class="compare-col">${buildChart(valsB, 'ä¸å®‰å®šãªãƒ‡ãƒ¼ã‚¿')}</div>`;
  html += '</div>';

  // Stability verdict
  html += '<div style="margin-top:16px; padding:12px 16px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); font-family:var(--font-mono); font-size:0.82rem;">';
  html += '<span class="label">å®‰å®šæ€§åˆ¤å®š</span>';
  html += `<div style="margin-top:4px">å®‰å®šãƒ‡ãƒ¼ã‚¿ â€” å¤‰å‹•ä¿‚æ•°: <span class="${sA.cv < 2 ? 'ok' : 'err'}">${numFmt(sA.cv)}</span> â†’ <span class="${sA.cv < 2 ? 'ok' : 'err'}">${sA.cv < 2 ? 'âœ“ å®‰å®š' : 'âœ— ä¸å®‰å®š'}</span></div>`;
  html += `<div>ä¸å®‰å®šãƒ‡ãƒ¼ã‚¿ â€” å¤‰å‹•ä¿‚æ•°: <span class="${sB.cv < 2 ? 'ok' : 'err'}">${numFmt(sB.cv)}</span> â†’ <span class="${sB.cv < 2 ? 'ok' : 'err'}">${sB.cv < 2 ? 'âœ“ å®‰å®š' : 'âœ— ä¸å®‰å®š'}</span></div>`;
  html += '<div style="color:var(--text-dim); font-size:0.72rem; margin-top:8px">â€» å¤‰å‹•ä¿‚æ•°ï¼ˆCVï¼‰= æ¨™æº–åå·® / å¹³å‡ã€‚8ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã®çµæœãŒã°ã‚‰ã¤ãã»ã©ãƒ‡ãƒ¼ã‚¿ã¯ä¸å®‰å®š</div>';
  html += '</div>';

  out.innerHTML = html;
}

// === Demo 2: Ïƒ Provenance ===
function runDemo2() {
  const out = document.getElementById('output2');
  if (!window.rei) { out.innerHTML = '<span class="err">Reiã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ä¸­...</span>'; return; }

  const code = document.getElementById('code2').value.trim();
  window.rei.reset();
  const r = safeRei(code);
  if (!r.ok) { out.innerHTML = `<span class="err">${r.error}</span>`; return; }

  const sigma = r.value;
  if (!sigma || sigma.reiType !== 'SigmaResult') {
    out.innerHTML = `<span class="val">${JSON.stringify(r.value, null, 2)}</span>`;
    return;
  }

  // Build timeline visualization
  let html = '<span class="label">Ïƒ æ¥æ­´ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</span>';
  html += '<div class="timeline">';

  // Starting value (from memory[0])
  const memory = sigma.memory || [];
  const will = sigma.will || {};

  memory.forEach((m, i) => {
    const displayVal = typeof m === 'object' ?
      (m.reiType === 'MDim' ? `ğ•„{${m.center}; ${m.neighbors.join(', ')}}` : JSON.stringify(m)) :
      numFmt(m);
    html += `<div class="timeline-node">
      <div class="timeline-val">${displayVal}</div>
      <div class="timeline-op">memory[${i}]</div>
    </div>`;
    if (i < memory.length - 1) {
      html += '<div class="timeline-arrow">â†’</div>';
    }
  });

  // Final result
  html += '<div class="timeline-arrow">â†’</div>';
  html += `<div class="timeline-node">
    <div class="timeline-val" style="border-color:var(--accent); color:var(--accent)">${numFmt(sigma.field?.center ?? '?')}</div>
    <div class="timeline-op" style="color:var(--accent)">æœ€çµ‚å€¤</div>
  </div>`;
  html += '</div>';

  // Will / Tendency
  html += '<div style="margin-top:16px; display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px;">';

  // Tendency
  const tendencyIcon = will.tendency === 'expand' ? 'â†—' : will.tendency === 'contract' ? 'â†˜' : 'â†’';
  const tendencyColor = will.tendency === 'expand' ? 'var(--green)' : will.tendency === 'contract' ? 'var(--red)' : 'var(--text-dim)';
  html += `<div style="background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); padding:12px; text-align:center;">
    <div style="font-size:1.5rem; color:${tendencyColor}">${tendencyIcon}</div>
    <div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim); margin-top:4px;">Ï„ å‚¾å‘: ${will.tendency || 'rest'}</div>
  </div>`;

  // Strength
  html += `<div style="background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); padding:12px; text-align:center;">
    <div style="font-size:1.5rem; color:var(--accent)">${numFmt(will.strength || 0)}</div>
    <div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim); margin-top:4px;">æ„å¿—ã®å¼·åº¦</div>
  </div>`;

  // Flow
  const flow = sigma.flow || {};
  html += `<div style="background:var(--bg); border:1px solid var(--border); border-radius:var(--radius); padding:12px; text-align:center;">
    <div style="font-size:1.5rem; color:var(--blue)">${flow.direction || 'rest'}</div>
    <div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim); margin-top:4px;">æµã‚Œã®æ–¹å‘</div>
  </div>`;

  html += '</div>';

  // History
  if (will.history && will.history.length > 0) {
    html += `<div style="margin-top:12px; font-family:var(--font-mono); font-size:0.78rem; color:var(--text-dim);">
      æ„å¿—ã®å¤‰é·: ${will.history.map(h => {
        const c = h === 'expand' ? 'var(--green)' : h === 'contract' ? 'var(--red)' : 'var(--text-dim)';
        return `<span style="color:${c}">${h}</span>`;
      }).join(' â†’ ')}
    </div>`;
  }

  out.innerHTML = html;
}

// === Demo 3: Resonance ===
function runDemo3() {
  const out = document.getElementById('output3');
  if (!window.rei) { out.innerHTML = '<span class="err">Reiã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ä¸­...</span>'; return; }

  const lines = document.getElementById('code3').value.split('\n').filter(l => l.trim() && !l.trim().startsWith('//'));
  let html = '';

  lines.forEach((line, idx) => {
    window.rei.reset();
    const r = safeRei(line.trim());
    if (!r.ok) {
      html += `<div style="margin-bottom:12px"><span class="err">${line.trim()}: ${r.error}</span></div>`;
      return;
    }

    const v = r.value;
    if (v && v.reiType === 'ResonanceResult') {
      const strength = v.strength;
      const barWidth = Math.max(5, strength * 100);
      const color = strength > 0.7 ? 'var(--green)' : strength > 0.4 ? 'var(--accent)' : 'var(--red)';

      html += `<div style="margin-bottom:16px; padding:12px 16px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius);">`;
      html += `<div style="font-family:var(--font-mono); font-size:0.75rem; color:var(--text-dim); margin-bottom:8px;">${line.trim()}</div>`;
      html += `<div style="display:flex; align-items:center; gap:12px; margin-bottom:6px;">
        <div style="font-family:var(--font-mono); font-size:0.82rem; color:${color}; min-width:80px;">å…±é³´åº¦: ${(strength * 100).toFixed(1)}%</div>
        <div style="flex:1; height:16px; background:var(--bg-card); border-radius:8px; overflow:hidden;">
          <div style="width:${barWidth}%; height:100%; background:${color}; border-radius:8px; transition:width 0.5s;"></div>
        </div>
        <div style="font-family:var(--font-mono); font-size:0.72rem; color:${v.resonates ? 'var(--green)' : 'var(--red)'};">${v.resonates ? 'å…±é³´ âœ“' : 'ä¸å…±é³´ âœ—'}</div>
      </div>`;
      html += `<div style="font-family:var(--font-mono); font-size:0.68rem; color:var(--text-dim);">
        æ¬¡å…ƒä¸€è‡´: ${(v.dimMatch * 100).toFixed(0)}% Â· å€¤è¿‘æ¥: ${(v.valueProximity * 100).toFixed(0)}% Â· ãƒ‘ã‚¿ãƒ¼ãƒ³é¡ä¼¼: ${((v.patternSimilarity || 0) * 100).toFixed(0)}%
      </div>`;
      html += '</div>';
    } else if (v && v.reiType === 'BridgeResult') {
      html += `<div style="margin-bottom:16px; padding:12px 16px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius);">`;
      html += `<div style="font-family:var(--font-mono); font-size:0.75rem; color:var(--text-dim); margin-bottom:8px;">${line.trim()}</div>`;
      html += `<div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px;">
        <div style="text-align:center;">
          <div style="font-size:1.4rem; color:var(--accent);">Ã—${v.scaleFactor}</div>
          <div style="font-family:var(--font-mono); font-size:0.68rem; color:var(--text-dim);">ã‚¹ã‚±ãƒ¼ãƒ«</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:1.4rem; color:var(--accent);">${(v.similarity * 100).toFixed(0)}%</div>
          <div style="font-family:var(--font-mono); font-size:0.68rem; color:var(--text-dim);">æ§‹é€ é¡ä¼¼åº¦</div>
        </div>
        <div style="text-align:center;">
          <div style="font-size:1.4rem; color:${v.transferable ? 'var(--green)' : 'var(--red)'};">${v.transferable ? 'âœ“' : 'âœ—'}</div>
          <div style="font-family:var(--font-mono); font-size:0.68rem; color:var(--text-dim);">è»¢ç§»å¯èƒ½</div>
        </div>
      </div>`;
      html += '</div>';
    } else {
      html += `<div style="margin-bottom:8px"><span class="val">${JSON.stringify(v, null, 2)}</span></div>`;
    }
  });

  out.innerHTML = html;
}

// === Demo 4: Awakening ===
function runDemo4() {
  const out = document.getElementById('output4');
  if (!window.rei) { out.innerHTML = '<span class="err">Reiã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ä¸­...</span>'; return; }

  const lines = document.getElementById('code4').value.split('\n').filter(l => l.trim() && !l.trim().startsWith('//'));
  let html = '';

  lines.forEach((line, idx) => {
    window.rei.reset();
    const r = safeRei(line.trim());
    if (!r.ok) {
      html += `<div style="margin-bottom:12px"><span class="err">${r.error}</span></div>`;
      return;
    }

    const v = r.value;
    const awareness = typeof v === 'object' ? (v.value ?? v) : v;
    const pct = typeof awareness === 'number' ? awareness * 100 : 0;
    const isAwakened = pct >= 50;
    const label = idx === 0 ? 'æœªè¨ˆç®—ã®å€¤' : 'è¨ˆç®—ã‚’çµŒé¨“ã—ãŸå€¤';

    html += `<div style="margin-bottom:16px; padding:12px 16px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius);">`;
    html += `<div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim); margin-bottom:4px;">${label}</div>`;
    html += `<div style="font-family:var(--font-mono); font-size:0.75rem; color:var(--accent-dim); margin-bottom:8px;">${line.trim()}</div>`;
    html += '<div class="awakening-meter">';
    html += `<div class="meter-track"><div class="meter-fill ${isAwakened ? 'awakened' : ''}" style="width:${pct}%"></div></div>`;
    html += `<div class="meter-label" style="color:${isAwakened ? 'var(--accent)' : 'var(--text-dim)'}">${pct.toFixed(0)}%</div>`;
    html += '</div>';
    html += `<div style="font-family:var(--font-mono); font-size:0.72rem; color:${isAwakened ? 'var(--accent)' : 'var(--text-dim)'}; margin-top:4px;">
      ${isAwakened ? 'è¦šé†’ â€” ã“ã®å€¤ã¯è‡ªåˆ†ã‚’çŸ¥ã£ã¦ã„ã‚‹' : 'æœªè¦šé†’ â€” ã¾ã ååˆ†ãªè¨ˆç®—çµŒé¨“ãŒãªã„'}
    </div>`;
    html += '</div>';
  });

  // Progression chart
  html += '<div style="margin-top:16px; padding:12px 16px; background:var(--bg); border:1px solid var(--border); border-radius:var(--radius);">';
  html += '<span class="label">è¦šé†’ã®é€²è¡Œ</span>';
  html += '<div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim); margin-bottom:8px;">ãƒ‘ã‚¤ãƒ—ã‚’é€šéã™ã‚‹ãŸã³ã«è¦šé†’åº¦ãŒã©ã†å¤‰åŒ–ã™ã‚‹ã‹</div>';

  const steps = [];
  for (let i = 0; i <= 7; i++) {
    window.rei.reset();
    const pipes = '|> abs '.repeat(i) + '|> awareness';
    const code = `ğ•„{5; 1,2,3,4,5,6,7,8} ${pipes}`;
    const r = safeRei(code);
    if (r.ok) {
      const val = typeof r.value === 'object' ? (r.value.value ?? 0) : r.value;
      steps.push({ pipes: i, awareness: typeof val === 'number' ? val : 0 });
    }
  }

  if (steps.length > 0) {
    const maxA = Math.max(...steps.map(s => s.awareness), 0.01);
    html += '<div class="bar-chart" style="height:100px;">';
    steps.forEach(s => {
      const h = Math.max(2, (s.awareness / Math.max(maxA, 1)) * 80);
      const color = s.awareness >= 0.5 ? 'var(--accent)' : 'var(--accent-dim)';
      html += `<div class="bar-col">
        <div class="bar-val">${(s.awareness * 100).toFixed(0)}%</div>
        <div class="bar" style="height:${h}px;background:${color}"></div>
        <div class="bar-label" style="writing-mode:horizontal-tb; height:auto;">${s.pipes}ãƒ‘ã‚¤ãƒ—</div>
      </div>`;
    });
    html += '</div>';
  }

  html += '</div>';
  out.innerHTML = html;
}

// === Demo 5: Free Playground ===
function runDemo5() {
  const out = document.getElementById('output5');
  if (!window.rei) { out.innerHTML = '<span class="err">Reiã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿ä¸­...</span>'; return; }

  const code = document.getElementById('code5').value.trim();
  const lines = code.split('\n').filter(l => l.trim() && !l.trim().startsWith('//'));

  let html = '';
  lines.forEach(line => {
    window.rei.reset();
    const r = safeRei(line.trim());
    html += `<div style="margin-bottom:8px;">`;
    html += `<div style="font-family:var(--font-mono); font-size:0.72rem; color:var(--text-dim);">â¯ ${line.trim()}</div>`;
    if (r.ok) {
      const formatted = typeof r.value === 'object' ? JSON.stringify(r.value, null, 2) : String(r.value);
      html += `<div style="font-family:var(--font-mono); font-size:0.82rem; color:var(--accent); white-space:pre-wrap; margin-top:2px;">${formatted}</div>`;
    } else {
      html += `<div style="font-family:var(--font-mono); font-size:0.82rem; color:var(--red); margin-top:2px;">${r.error}</div>`;
    }
    html += '</div>';
  });

  out.innerHTML = html;
}

function resetDemo5() {
  if (window.rei) window.rei.reset();
  document.getElementById('code5').value = `// ä¾‹: ãƒ‡ãƒ¼ã‚¿ã®å…¨ãƒ¢ãƒ¼ãƒ‰åˆæ„å½¢æˆ\nğ•„{100; 30, 70, 50, 90, 10} |> consensus`;
  document.getElementById('output5').innerHTML = '<span class="dim">ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ</span>';
}
</script>
</body>
</html>
