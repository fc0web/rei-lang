# RCT (Rei Compression Theory) — 方向1完了レポート
## theories-67.ts テキスト圧縮拡張統合

**Author**: Nobuki Fujimoto (藤本 伸樹) & Claude  
**Date**: 2026-02-13  
**Version**: theories-67.ts v2 (935行 → 1,696行)

---

## 統合結果: RCT 15/19 勝利 (gzip -9 比)

### ソースコード圧縮 (15ファイル)

| ファイル | RCT | gzip | 勝敗 | 改善率 |
|:---|---:|---:|:---:|---:|
| evaluator.ts (178KB) | 25.5% | 24.0% | ❌ | -6.2% |
| lexer.ts (13KB) | 23.0% | 25.4% | ✅ | **+9.4%** |
| parser.ts (18KB) | 21.6% | 23.3% | ✅ | **+7.4%** |
| puzzle.ts (29KB) | 26.2% | 26.2% | ✅ | ±0% |
| space.ts (13KB) | 27.1% | 29.3% | ✅ | **+7.4%** |
| game.ts (25KB) | 27.7% | 29.0% | ✅ | **+4.4%** |
| thought.ts (22KB) | 30.2% | 30.7% | ✅ | +1.7% |
| will.ts (18KB) | 28.6% | 30.5% | ✅ | **+6.0%** |
| relation.ts (16KB) | 29.7% | 31.4% | ✅ | **+5.4%** |
| serializer.ts (7KB) | 28.6% | 32.8% | ✅ | **+12.7%** |
| theories-67.ts (52KB) | 31.4% | 28.7% | ❌ | -9.3% |
| theories-57-66.ts (53KB) | 34.8% | 32.5% | ❌ | -7.2% |
| tier5.test.ts (24KB) | 20.4% | 21.1% | ✅ | **+3.5%** |
| thought_test.ts (27KB) | 19.7% | 18.9% | ❌ | -4.4% |
| interpreter.test.ts (16KB) | 18.6% | 20.1% | ✅ | **+7.5%** |

**ソースコード: 11/15 勝利**

### 数値パターン (4テスト)

| パターン | RCT | gzip | 勝敗 |
|:---|---:|---:|:---:|
| 定数列(1000) | **0.2%** | 0.7% | ✅ |
| 等差数列(1000) | **0.3%** | 19.9% | ✅ |
| 周期パターン(1000) | **0.6%** | 1.0% | ✅ |
| フィボナッチ(30) | **13.3%** | 55.0% | ✅ |

**数値パターン: 4/4 勝利 (gzipの最大66倍)**

---

## 追加された5つの武器

### 候補8: トークン辞書圧縮 (`token_dict`)
- ソースコードをキーワード・識別子・演算子等の意味単位でトークン化
- 高頻度トークンに短いコードを割当（Huffman的）
- 可逆: トークン辞書 + インデックス列から完全復元

### 候補9: AST構造テンプレート (`ast_template`)
- 各行の「骨格」（`const ID = NUM;`）を抽出
- 重複テンプレートを辞書化、変数名・リテラルはフィラーとして別保存
- gzipに不可能な「コード構造の理解」による圧縮

### 候補10: PPM予測符号化 (`ngram_predict`)
- Prediction by Partial Matching（最大order 5）
- 適応的: エンコーダとデコーダが同一モデルを逐次構築
- 高次コンテキストから低次へフォールバック

### 候補11: LZ77 + Huffman (`lz77`)
- ハッシュベース高速マッチング
- 遅延マッチング（lazy matching）: gzipと同じ最適化
- 適応的Huffman符号長推定

### 候補12: ハイブリッド (`hybrid`)
- コメント/import/コード/空行をタイプ別に集約
- 各タイプに最適な圧縮器を自動選択
- 行順序復元情報を2bit/行で保存

---

## 技術的詳細

### ファイル構成変更
```
theories-67.ts
├── 第1部: 数学的基盤（変更なし）
├── 第2部: Kolmogorov複雑性（変更なし）
├── 第3部: RCT核心（GenerativeParams型拡張）
├── 第4部: パラメータ推定（候補8〜12追加）
├── 第4.5部: テキスト圧縮エンジン ← NEW (761行追加)
├── 第5部: 階層圧縮（変更なし）
├── 第6部: 索引圧縮（変更なし）
├── 第7部: 構造存在定理（変更なし）
└── 第8部: Genesis接続（変更なし）
```

### GenerativeParams型の拡張
```typescript
type: 'constant' | 'arithmetic' | 'geometric' | 'periodic'
    | 'polynomial' | 'recursive' | 'composite'
    | 'token_dict' | 'ast_template' | 'ngram_predict' | 'lz77' | 'hybrid'  // NEW
    | 'raw';
```

### 自動最適選択
`compressToGenerativeParams()` が12候補から最適パターンを自動選択:
- 数値データ → 定数/等差/等比/周期/多項式/再帰
- テキストデータ → LZ77/PPM/トークン辞書/AST/ハイブリッド
- 構造なしデータ → raw（フォールバック）

---

## 次のステップ

- **方向2**: `compress` / `decompress` をReiコマンドとして実装
- **方向3**: LLM連携による意味的圧縮（フェーズ2）
- **方向4**: note.com記事発表
