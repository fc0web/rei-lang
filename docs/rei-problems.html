<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rei (0â‚€å¼) â€” Problems Only Rei Can Solve</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=IBM+Plex+Mono:wght@300;400;500&family=Noto+Serif+JP:wght@400;600&display=swap');

*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0f1117;--bg2:#161922;--bg3:#1c2030;
  --gold:#c4a265;--gold-dim:#8a7245;--gold-bright:#e0c88a;
  --blue:#5a8fc5;--green:#5ec47a;--red:#e05555;--cyan:#4ecdc4;
  --purple:#9b72cf;--text:#c8c8d0;--text-dim:#72727e;
  --kappa:#ff9f43;--phase:#6c5ce7;
  --font-display:'Cormorant Garamond',serif;
  --font-mono:'IBM Plex Mono',monospace;
  --font-jp:'Noto Serif JP',serif;
}
body{background:var(--bg);color:var(--text);font-family:var(--font-mono);line-height:1.7;min-height:100vh}
a{color:var(--blue);text-decoration:none}
a:hover{color:var(--gold)}

/* Header */
.header{text-align:center;padding:60px 20px 40px;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:200px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.header h1{font-family:var(--font-display);font-size:2.8em;color:var(--gold);font-weight:700;letter-spacing:0.05em}
.header .subtitle{font-family:var(--font-jp);color:var(--text-dim);margin-top:8px;font-size:0.95em}
.header .badge{display:inline-block;margin-top:16px;padding:4px 16px;border:1px solid var(--gold-dim);border-radius:20px;font-size:0.75em;color:var(--gold-dim);letter-spacing:0.1em}

/* Nav */
.nav{display:flex;justify-content:center;gap:8px;padding:0 20px 30px;flex-wrap:wrap}
.nav button{background:var(--bg2);border:1px solid #2a2d3a;color:var(--text-dim);padding:8px 16px;border-radius:6px;cursor:pointer;font-family:var(--font-mono);font-size:0.8em;transition:all .2s}
.nav button:hover,.nav button.active{border-color:var(--gold);color:var(--gold);background:rgba(196,162,101,0.08)}
.nav button .count{font-size:0.7em;opacity:0.6;margin-left:4px}

/* Stats bar */
.stats{display:flex;justify-content:center;gap:30px;padding:0 20px 30px;font-size:0.8em}
.stats .stat{text-align:center}
.stats .stat-val{font-size:1.6em;font-weight:500;color:var(--gold)}
.stats .stat-label{color:var(--text-dim);font-size:0.85em}

/* Problem Container */
.problems{max-width:900px;margin:0 auto;padding:0 20px 60px}

/* Problem Card */
.problem{background:var(--bg2);border:1px solid #2a2d3a;border-radius:10px;margin-bottom:20px;overflow:hidden;transition:border-color .3s}
.problem:hover{border-color:#3a3d4a}
.problem.solved{border-color:var(--green)}
.problem.solved .p-header{border-bottom-color:rgba(94,196,122,0.2)}

.p-header{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid #2a2d3a;cursor:pointer;user-select:none}
.p-number{font-family:var(--font-display);font-size:1.4em;color:var(--gold-dim);min-width:36px}
.p-title{flex:1;font-size:0.95em;font-weight:500;color:var(--text)}
.p-tags{display:flex;gap:6px}
.p-tag{padding:2px 8px;border-radius:4px;font-size:0.65em;text-transform:uppercase;letter-spacing:0.08em}
.p-tag.phase{background:rgba(108,92,231,0.15);color:var(--phase)}
.p-tag.kappa{background:rgba(255,159,67,0.15);color:var(--kappa)}
.p-tag.pipe{background:rgba(78,205,196,0.15);color:var(--cyan)}
.p-tag.center{background:rgba(90,143,197,0.15);color:var(--blue)}
.p-tag.genesis{background:rgba(155,114,207,0.15);color:var(--purple)}
.p-tag.compress{background:rgba(94,196,122,0.15);color:var(--green)}
.p-tag.witness{background:rgba(224,85,85,0.15);color:var(--red)}
.p-diff{font-size:0.7em;padding:3px 8px;border-radius:4px}
.p-diff.d1{color:#5ec47a;background:rgba(94,196,122,0.1)}
.p-diff.d2{color:var(--gold);background:rgba(196,162,101,0.1)}
.p-diff.d3{color:var(--red);background:rgba(224,85,85,0.1)}
.p-toggle{color:var(--text-dim);font-size:1.2em;transition:transform .3s}
.p-toggle.open{transform:rotate(90deg)}

.p-body{display:none;padding:20px}
.p-body.open{display:block}
.p-desc{margin-bottom:16px;color:var(--text);font-size:0.88em;line-height:1.8}
.p-desc .jp{font-family:var(--font-jp);color:var(--text-dim);font-size:0.9em;margin-top:4px}

/* Code blocks */
.code-block{position:relative;margin:12px 0;border-radius:8px;overflow:hidden}
.code-label{font-size:0.7em;color:var(--text-dim);padding:8px 16px 4px;background:var(--bg3);letter-spacing:0.08em;text-transform:uppercase}
.code-label.rei{color:var(--gold)}
.code-label.python,.code-label.other{color:var(--blue)}
pre{background:var(--bg3);padding:12px 16px;overflow-x:auto;font-size:0.82em;line-height:1.7;border-bottom:1px solid #2a2d3a}
pre code{font-family:var(--font-mono)}
.kw{color:var(--gold)}
.op{color:var(--cyan)}
.fn{color:var(--blue)}
.num{color:var(--green)}
.str{color:var(--kappa)}
.cm{color:var(--text-dim);font-style:italic}
.ph{color:var(--phase)}
.ka{color:var(--kappa)}
.err{color:var(--red);text-decoration:line-through wavy var(--red)}

/* Comparison */
.comparison{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0}
.comparison .col-header{font-size:0.75em;color:var(--text-dim);text-align:center;padding:6px;border-bottom:1px solid #2a2d3a}
.comparison .col-header.rei-col{color:var(--gold)}
@media(max-width:700px){.comparison{grid-template-columns:1fr}}

/* Quiz */
.quiz{margin-top:16px;padding:16px;background:var(--bg);border-radius:8px;border:1px solid #2a2d3a}
.quiz-q{font-size:0.88em;margin-bottom:12px;color:var(--gold-dim)}
.quiz-options{display:flex;flex-direction:column;gap:8px}
.quiz-opt{padding:10px 16px;background:var(--bg2);border:1px solid #2a2d3a;border-radius:6px;cursor:pointer;font-size:0.82em;transition:all .2s}
.quiz-opt:hover{border-color:var(--gold-dim);background:rgba(196,162,101,0.05)}
.quiz-opt.correct{border-color:var(--green);background:rgba(94,196,122,0.1);color:var(--green)}
.quiz-opt.incorrect{border-color:var(--red);background:rgba(224,85,85,0.1);color:var(--red)}
.quiz-opt.disabled{pointer-events:none;opacity:0.7}
.quiz-explain{display:none;margin-top:12px;padding:12px;background:rgba(196,162,101,0.05);border-radius:6px;font-size:0.82em;border-left:3px solid var(--gold-dim);line-height:1.7}
.quiz-explain.show{display:block}

/* Lines metric */
.lines-metric{display:flex;align-items:center;gap:12px;margin:16px 0;padding:12px 16px;background:var(--bg);border-radius:6px}
.lines-bar{flex:1;height:8px;background:#2a2d3a;border-radius:4px;overflow:hidden;position:relative}
.lines-bar-fill{height:100%;border-radius:4px;transition:width .5s ease}
.lines-bar-fill.rei{background:var(--gold)}
.lines-bar-fill.other{background:var(--blue)}
.lines-label{font-size:0.75em;min-width:100px}
.lines-count{font-size:0.85em;font-weight:500;min-width:50px;text-align:right}

/* Footer */
.footer{text-align:center;padding:40px 20px;border-top:1px solid #1e2130;color:var(--text-dim);font-size:0.8em}
.footer a{color:var(--gold-dim)}
</style>
</head>
<body>

<div class="header">
  <h1>Rei (0â‚€å¼)</h1>
  <div class="subtitle">Reiã§ã—ã‹æ›¸ã‘ãªã„å•é¡Œé›† â€” Problems Only Rei Can Solve</div>
  <div class="badge">REI_SPEC v0.1 Â· 12 PROBLEMS Â· REFERENCE IMPLEMENTATION</div>
</div>

<div class="nav" id="nav"></div>

<div class="stats">
  <div class="stat"><div class="stat-val" id="score">0</div><div class="stat-label">æ­£ç­”æ•°</div></div>
  <div class="stat"><div class="stat-val" id="total">12</div><div class="stat-label">å…¨å•é¡Œ</div></div>
  <div class="stat"><div class="stat-val" id="solved">0</div><div class="stat-label">å®Œäº†</div></div>
</div>

<div class="problems" id="problems"></div>

<div class="footer">
  <a href="https://github.com/fc0web/rei-lang">GitHub Repository</a> ï½œ Author: Nobuki Fujimoto ï½œ License: Apache 2.0<br>
  <span style="font-family:var(--font-jp);margin-top:8px;display:inline-block">D-FUMT Mathematical Computation System</span>
</div>

<script>
const PROBLEMS = [
  // ===== Category: Phase Guard (@ Phase) =====
  {
    id:1, category:'phase', difficulty:1,
    title:'Phase Guard â€” å‹å®‰å…¨ãªä¸å¯é€†é·ç§»',
    tags:['phase'],
    desc:`Reiã®ç›¸è»¢ç§»ã‚¬ãƒ¼ãƒ‰ï¼ˆ@ Phaseï¼‰ã¯ã€ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®çŠ¶æ…‹é·ç§»ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«å¼·åˆ¶ã—ã¾ã™ã€‚
Open â†’ Sealed â†’ Compacted ã®ä¸€æ–¹é€šè¡Œã‚’æ–‡æ³•ãƒ¬ãƒ™ãƒ«ã§ä¿è¨¼ã™ã‚‹è¨˜æ³•ã¯ã€ä»–è¨€èªã«å­˜åœ¨ã—ã¾ã›ã‚“ã€‚`,
    descJp:'ISLã®ä¸å¯é€†æ€§ã‚’è¨€èªæ–‡æ³•ã«åŸ‹ã‚è¾¼ã‚“ã ã€Reiç‹¬è‡ªã®è¨˜æ³•ã§ã™ã€‚',
    reiCode:`<span class="cm">// ç›¸ã‚¬ãƒ¼ãƒ‰ä»˜ãé–¢æ•°å®šç¾©</span>
<span class="kw">compress</span> <span class="fn">normalize</span>(p: Pipeline <span class="ph">@ Open</span>) = p |&gt; phi
<span class="kw">compress</span> <span class="fn">commit</span>(p: Pipeline <span class="ph">@ Open</span>) -&gt; Pipeline <span class="ph">@ Sealed</span> = p |&gt; psi
<span class="kw">compress</span> <span class="fn">compact</span>(s: Pipeline <span class="ph">@ Sealed</span>) -&gt; Pipeline <span class="ph">@ Compacted</span> = s |&gt; omega

<span class="cm">// æ­£å¸¸ãªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</span>
<span class="kw">let</span> p = createPipeline(state)
<span class="kw">let</span> n = <span class="fn">normalize</span>(p)     <span class="cm">// âœ… @ Open â†’ @ Open</span>
<span class="kw">let</span> s = <span class="fn">commit</span>(n)        <span class="cm">// âœ… @ Open â†’ @ Sealed</span>
<span class="kw">let</span> c = <span class="fn">compact</span>(s)       <span class="cm">// âœ… @ Sealed â†’ @ Compacted</span>

<span class="cm">// é•åï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰</span>
<span class="err">normalize(s)</span>              <span class="cm">// âŒ expected @ Open, got @ Sealed</span>
<span class="err">compact(p)</span>                <span class="cm">// âŒ expected @ Sealed, got @ Open</span>`,
    otherLabel:'TypeScript (æ‰‹å‹•ãƒã‚§ãƒƒã‚¯)',
    otherCode:`<span class="cm">// TypeScript: ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã§ã—ã‹æ¤œå‡ºã§ããªã„</span>
<span class="kw">function</span> <span class="fn">normalize</span>(p: Pipeline) {
  <span class="kw">if</span> (p.stage !== <span class="str">'open'</span>)
    <span class="kw">throw new</span> Error(<span class="str">'Wrong stage'</span>);
  <span class="cm">// ... 12è¡Œã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰</span>
}
<span class="cm">// discriminated union ã§å‹å®‰å…¨ã«ã§ãã‚‹ãŒ
// @ Phase ã®ã‚ˆã†ãª1ãƒˆãƒ¼ã‚¯ãƒ³è¨˜æ³•ã¯ä¸å¯èƒ½</span>`,
    reiLines:10, otherLines:30,
    quiz:'Phase Guard ãŒé˜²ãæ”»æ’ƒã¯ï¼Ÿ',
    options:['SQL Injection','Phase Regressionï¼ˆç›¸ã®é€†è¡Œï¼‰','Buffer Overflow','XSS'],
    answer:1,
    explain:'@ Phase ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ç›¸ã®é€†è¡Œï¼ˆSealed â†’ Open ç­‰ï¼‰ã‚’æ¤œå‡ºã—ã¾ã™ã€‚ISLã®ä¸å¯é€†æ€§åŸç†ã‚’æ–‡æ³•ãƒ¬ãƒ™ãƒ«ã§ä¿è¨¼ã™ã‚‹ã€Reiç‹¬è‡ªã®é˜²å¾¡æ©Ÿæ§‹ã§ã™ã€‚'
  },
  {
    id:2, category:'phase', difficulty:2,
    title:'Genesis Phase Chain â€” è™šç„¡ã‹ã‚‰æ•°ã¸ã®å…¨éç¨‹',
    tags:['phase','genesis'],
    desc:`Genesiså…¬ç†ç³»ã®5æ®µéšï¼ˆvoid â†’ dot â†’ zero_zero â†’ zero â†’ numberï¼‰ã‚’ã€
ç›¸ã‚¬ãƒ¼ãƒ‰ä»˜ãã®compressãƒã‚§ãƒ¼ãƒ³ã§è¨˜è¿°ã—ã¾ã™ã€‚å„æ®µéšã®ã‚¹ã‚­ãƒƒãƒ—ã¯ä¸å¯èƒ½ã§ã™ã€‚`,
    descJp:'ã€Œæ•°ã®èª•ç”Ÿã€ã‚’å‹å®‰å…¨ã«è¨˜è¿°ã§ãã‚‹ã®ã¯Reiã ã‘ã§ã™ã€‚',
    reiCode:`<span class="cm">// Genesiså…¨éç¨‹ã‚’ç›¸ã‚¬ãƒ¼ãƒ‰ã§å‹å®‰å…¨ã«è¨˜è¿°</span>
<span class="kw">compress</span> <span class="fn">emerge</span>(g: Genesis <span class="ph">@ void</span>) -&gt; Genesis <span class="ph">@ dot</span> =
  existence(g)

<span class="kw">compress</span> <span class="fn">separate</span>(g: Genesis <span class="ph">@ dot</span>) -&gt; Genesis <span class="ph">@ zero_zero</span> =
  structure_separation(g)

<span class="kw">compress</span> <span class="fn">fix</span>(g: Genesis <span class="ph">@ zero_zero</span>) -&gt; Genesis <span class="ph">@ zero</span> =
  value_fixation(g)

<span class="kw">compress</span> <span class="fn">generate</span>(g: Genesis <span class="ph">@ zero</span>) -&gt; Genesis <span class="ph">@ number</span> =
  number_genesis(g)

<span class="cm">// æ­£å¸¸ãªç”Ÿæˆãƒã‚§ãƒ¼ãƒ³</span>
<span class="kw">let</span> n = âˆ… |&gt; <span class="fn">emerge</span> |&gt; <span class="fn">separate</span> |&gt; <span class="fn">fix</span> |&gt; <span class="fn">generate</span>

<span class="cm">// ã‚¹ã‚­ãƒƒãƒ—ä¸å¯ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ï¼‰</span>
<span class="err">âˆ… |&gt; separate</span>   <span class="cm">// âŒ expected @ dot, got @ void</span>`,
    otherLabel:'Python / Haskell',
    otherCode:`<span class="cm"># Python: å…¨ã¦æ‰‹å‹•ãƒã‚§ãƒƒã‚¯</span>
<span class="kw">def</span> <span class="fn">emerge</span>(g):
  <span class="kw">assert</span> g.phase == <span class="str">'void'</span>
  <span class="cm">...</span>
<span class="kw">def</span> <span class="fn">separate</span>(g):
  <span class="kw">assert</span> g.phase == <span class="str">'dot'</span>
  <span class="cm">...</span>

<span class="cm"># Haskell: GADTs ã§è¿‘ã¥ã‘ã‚‹ãŒ
# 5æ®µéšã®ç›¸é·ç§»ã‚’1ãƒˆãƒ¼ã‚¯ãƒ³ã§è¡¨ç¾ã™ã‚‹
# è¨˜æ³•ã¯å­˜åœ¨ã—ãªã„</span>`,
    reiLines:12, otherLines:45,
    quiz:'Genesisç›¸é·ç§»ã§ void â†’ zero_zero ãŒç¦æ­¢ã•ã‚Œã‚‹ç†ç”±ã¯ï¼Ÿ',
    options:['ãƒ¡ãƒ¢ãƒªä¸è¶³','æ®µéšã‚¹ã‚­ãƒƒãƒ—ã¯å˜èª¿æ€§é•å','æ§‹æ–‡ã‚¨ãƒ©ãƒ¼','å‹æ¨è«–ã®é™ç•Œ'],
    answer:1,
    explain:'GA-v2ã®å˜èª¿æ€§ä¿è¨¼ï¼ˆmonotonicity guaranteeï¼‰ã«ã‚ˆã‚Šã€ç›¸é·ç§»ã¯1æ®µéšãšã¤ã—ã‹é€²ã‚ã¾ã›ã‚“ã€‚void â†’ dot â†’ zero_zero ãŒæ­£ã—ã„çµŒè·¯ã§ã€æ®µé£›ã°ã—ã¯phaseDelta > 1 ã¨ãªã‚Šé•åã§ã™ã€‚'
  },

  // ===== Category: Curvature Literal (Îº) =====
  {
    id:3, category:'kappa', difficulty:1,
    title:'Curvature Literal â€” æ›²ç‡ä»˜ãæ•°å€¤',
    tags:['kappa'],
    desc:`Îºï¼ˆã‚«ãƒƒãƒ‘ï¼‰ãƒªãƒ†ãƒ©ãƒ«ã¯ã€æ•°å€¤ã«ã€Œç›¸è»¢ç§»ã¸ã®è¿‘ã•ã€ã‚’ä»˜ä¸ã—ã¾ã™ã€‚
5Îº0.3 ã¯ã€Œå€¤5ã€æ›²ç‡0.3ã€ã‚’æ„å‘³ã—ã€è¨ˆç®—ã‚’é€šã˜ã¦æ›²ç‡ãŒè‡ªå‹•ä¼æ¬ã—ã¾ã™ã€‚`,
    descJp:'æ•°å€¤ã«ç†è«–çš„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ†ãƒ©ãƒ«ã§ä»˜ã‘ã‚‹è¨˜æ³•ã¯ã€ä»–è¨€èªã«å‰ä¾‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚',
    reiCode:`<span class="cm">// æ›²ç‡ãƒªãƒ†ãƒ©ãƒ« â€” 5Îº0.3 = {value:5, curvature:0.3}</span>
<span class="kw">let</span> x = <span class="num">5</span><span class="ka">Îº0.3</span>
<span class="kw">let</span> y = <span class="num">3</span><span class="ka">Îº0.5</span>

<span class="cm">// åŠ ç®—: æ›²ç‡ã¯åŠ é‡å¹³å‡ã§ä¼æ¬</span>
<span class="kw">let</span> sum = x + y          <span class="cm">// â†’ 8Îº0.375</span>

<span class="cm">// ä¹—ç®—: æ›²ç‡ã¯å¹¾ä½•å¹³å‡ã§ä¼æ¬</span>
<span class="kw">let</span> prod = x * y         <span class="cm">// â†’ 15Îº0.387</span>

<span class="cm">// ãƒ‘ã‚¤ãƒ—: æ›²ç‡ã¯ä¿å­˜</span>
x |&gt; <span class="fn">double</span>              <span class="cm">// â†’ 10Îº0.3</span>

<span class="cm">// æ›²ç‡æ¯”è¼ƒãƒ»æŠ½å‡º</span>
y <span class="op">&gt;Îº</span> x                   <span class="cm">// â†’ true (0.5 > 0.3)</span>
x<span class="op">.Îº</span>                       <span class="cm">// â†’ 0.3</span>`,
    otherLabel:'Python (æ‰‹å‹•å®Ÿè£…)',
    otherCode:`<span class="cm"># Python: ã‚¯ãƒ©ã‚¹ã§æ¨¡å€£ã™ã‚‹ã—ã‹ãªã„</span>
<span class="kw">class</span> <span class="fn">CurvatureValue</span>:
  <span class="kw">def</span> __init__(self, value, kappa):
    self.value = value
    self.kappa = kappa
  <span class="kw">def</span> __add__(self, other):
    v = self.value + other.value
    total = abs(self.value) + abs(other.value)
    k = (self.kappa*abs(self.value) +
         other.kappa*abs(other.value)) / total
    <span class="kw">return</span> CurvatureValue(v, k)
  <span class="cm"># ... __mul__, __gt__ ç­‰ã‚‚å…¨ã¦æ‰‹å‹•å®Ÿè£…</span>

x = CurvatureValue(<span class="num">5</span>, <span class="num">0.3</span>)  <span class="cm"># vs Rei: 5Îº0.3</span>`,
    reiLines:8, otherLines:35,
    quiz:'5Îº0.3 + 3Îº0.5 ã®æ›²ç‡ã®å€¤ã¯ï¼Ÿ',
    options:['0.4ï¼ˆç®—è¡“å¹³å‡ï¼‰','0.375ï¼ˆåŠ é‡å¹³å‡ï¼‰','0.387ï¼ˆå¹¾ä½•å¹³å‡ï¼‰','0.8ï¼ˆåˆè¨ˆï¼‰'],
    answer:1,
    explain:'åŠ ç®—æ™‚ã®Îºä¼æ¬ã¯åŠ é‡å¹³å‡ã§ã™: (0.3Ã—|5| + 0.5Ã—|3|) / (|5|+|3|) = (1.5+1.5)/8 = 0.375ã€‚å€¤ã®çµ¶å¯¾å€¤ã§é‡ã¿ä»˜ã‘ã•ã‚Œã¾ã™ã€‚'
  },
  {
    id:4, category:'kappa', difficulty:2,
    title:'Curvature-Driven Genesis â€” Îºã§ç›¸è»¢ç§»ã‚’é§†å‹•',
    tags:['kappa','genesis','phase'],
    desc:`æ›²ç‡ãƒªãƒ†ãƒ©ãƒ«ã¨Genesisç›¸é·ç§»ã‚’çµ„ã¿åˆã‚ã›ã€
ÎºãŒé–¾å€¤ï¼ˆ0.7ï¼‰ã«é”ã™ã‚‹ã¨è‡ªå‹•çš„ã«ç›¸è»¢ç§»ãŒç™ºç”Ÿã™ã‚‹éç¨‹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚`,
    descJp:'ã€Œã‚¨ãƒãƒ«ã‚®ãƒ¼è“„ç©â†’é–¾å€¤è¶…éâ†’ç›¸è»¢ç§»ã€ã‚’ãƒªãƒ†ãƒ©ãƒ«1ã¤ã§è¡¨ç¾ã§ãã¾ã™ã€‚',
    reiCode:`<span class="cm">// åˆæœŸçŠ¶æ…‹: voidç›¸ã€æ›²ç‡0</span>
<span class="kw">let</span> origin = <span class="num">0â‚€</span><span class="ka">Îº0.0</span>

<span class="cm">// ã‚¨ãƒãƒ«ã‚®ãƒ¼æ³¨å…¥ã§æ›²ç‡ä¸Šæ˜‡</span>
<span class="kw">let</span> step1 = origin |&gt; <span class="fn">energize</span>(<span class="num">0.3</span>)   <span class="cm">// 0â‚€Îº0.3</span>
<span class="kw">let</span> step2 = step1 |&gt; <span class="fn">energize</span>(<span class="num">0.3</span>)    <span class="cm">// 0â‚€Îº0.6</span>

<span class="cm">// æ›²ç‡æ¯”è¼ƒ</span>
step2 <span class="op">&gt;Îº</span> step1                        <span class="cm">// true</span>

<span class="cm">// é–¾å€¤è¶…é â†’ ç›¸è»¢ç§»!</span>
<span class="kw">let</span> step3 = step2 |&gt; <span class="fn">energize</span>(<span class="num">0.3</span>)    <span class="cm">// Îº=0.9 â‰¥ 0.7</span>
<span class="cm">// â†’ origin: 'transitioned'</span>
<span class="cm">// â†’ phase transition triggered!</span>

<span class="cm">// ç›¸è»¢ç§»å¾Œã®ã‚¬ãƒ¼ãƒ‰æ¤œæŸ»</span>
step3 |&gt; <span class="fn">evolve_until</span>(<span class="ka">Îº</span> &gt; <span class="num">0.85</span>)     <span class="cm">// æ¡ä»¶ä»˜ãé€²åŒ–</span>`,
    otherLabel:'å¾“æ¥æ‰‹æ³•',
    otherCode:`<span class="cm">// å¾“æ¥: é–¾å€¤ãƒã‚§ãƒƒã‚¯ã¯å¤–éƒ¨ãƒ­ã‚¸ãƒƒã‚¯</span>
state.curvature += <span class="num">0.3</span>;
<span class="kw">if</span> (state.curvature &gt;= THRESHOLD) {
  state.phase = nextPhase(state.phase);
  <span class="cm">// witnessç”Ÿæˆã€å˜èª¿æ€§ãƒã‚§ãƒƒã‚¯...</span>
  <span class="cm">// 15è¡Œä»¥ä¸Šã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆ</span>
}
<span class="cm">// æ›²ç‡ãŒã€Œæ•°å€¤ã®å±æ€§ã€ã§ã‚ã‚‹ã¨ã„ã†
// æ¦‚å¿µè‡ªä½“ãŒå­˜åœ¨ã—ãªã„</span>`,
    reiLines:9, otherLines:25,
    quiz:'GA-v2ã®æ›²ç‡é–¾å€¤ï¼ˆCURVATURE_THRESHOLDï¼‰ã¯ï¼Ÿ',
    options:['0.5','0.7','0.85','1.0'],
    answer:1,
    explain:'GA-v2ã§ã¯ CURVATURE_THRESHOLD = 0.7 ã¨å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ÎºãŒã“ã®å€¤ã«é”ã™ã‚‹ã¨ dot â†’ zero_zero ã®ç›¸è»¢ç§»æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¾ã™ã€‚'
  },

  // ===== Category: Directional Pipe =====
  {
    id:5, category:'pipe', difficulty:1,
    title:'Directional Pipe â€” æ–¹å‘æŒ‡å®šãƒ‘ã‚¤ãƒ—',
    tags:['pipe','center'],
    desc:`|>âŸ¨æ–¹å‘âŸ© ã¯ã€ä¸­å¿ƒ-è¿‘å‚è¨ˆç®—ã§ã©ã®æ–¹å‘ã®neighborã‚’ä½¿ã†ã‹ã‚’æŒ‡å®šã—ã¾ã™ã€‚
å…¨æ–¹å‘ï¼ˆ*ï¼‰ã€ç›´äº¤æ–¹å‘ï¼ˆorthoï¼‰ã€å¯¾è§’æ–¹å‘ï¼ˆdiagï¼‰ã€å€‹åˆ¥æŒ‡å®šãŒå¯èƒ½ã§ã™ã€‚`,
    descJp:'æ–¹å‘ã‚’ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã«åŸ‹ã‚è¾¼ã‚€è¨˜æ³•ã¯ã€ä¸–ç•Œåˆã§ã™ã€‚',
    reiCode:`<span class="kw">let</span> cell = <span class="fn">ğ•„</span>{<span class="num">5</span>; <span class="num">1,2,3,4,5,6,7,8</span>}

<span class="cm">// å…¨æ–¹å‘</span>
cell <span class="op">|&gt;âŸ¨*âŸ©</span> <span class="fn">convolve</span>(kernel)

<span class="cm">// ç›´äº¤æ–¹å‘ï¼ˆN,E,S,Wï¼‰ã®ã¿</span>
cell <span class="op">|&gt;âŸ¨orthoâŸ©</span> <span class="fn">gradient</span>

<span class="cm">// å¯¾è§’æ–¹å‘ï¼ˆNE,SE,SW,NWï¼‰ã®ã¿</span>
cell <span class="op">|&gt;âŸ¨diagâŸ©</span> <span class="fn">smooth</span>

<span class="cm">// ç‰¹å®šæ–¹å‘ã®æŒ‡å®š</span>
cell <span class="op">|&gt;âŸ¨N,NE,EâŸ©</span> <span class="fn">partial</span>(kernel)

<span class="cm">// é€†æ–¹å‘ï¼ˆå¤–â†’ä¸­å¿ƒé›†ç´„ï¼‰</span>
satellites <span class="op">&lt;|âŸ¨*âŸ©</span> <span class="fn">aggregate</span>(center)

<span class="cm">// ãƒã‚§ãƒ¼ãƒ³: ç›´äº¤â†’å¯¾è§’ã®2æ®µéš</span>
cell <span class="op">|&gt;âŸ¨orthoâŸ©</span> <span class="fn">gradient</span> <span class="op">|&gt;âŸ¨diagâŸ©</span> <span class="fn">smooth</span>`,
    otherLabel:'Python + NumPy',
    otherCode:`<span class="cm"># Python: æ–¹å‘ã”ã¨ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ‰‹å‹•ç®¡ç†</span>
ORTHO = [(<span class="num">0</span>,<span class="num">-1</span>),(<span class="num">1</span>,<span class="num">0</span>),(<span class="num">0</span>,<span class="num">1</span>),(<span class="num">-1</span>,<span class="num">0</span>)]
DIAG = [(<span class="num">1</span>,<span class="num">-1</span>),(<span class="num">1</span>,<span class="num">1</span>),(<span class="num">-1</span>,<span class="num">1</span>),(<span class="num">-1</span>,<span class="num">-1</span>)]

<span class="kw">def</span> <span class="fn">gradient_ortho</span>(grid, x, y):
  total = <span class="num">0</span>
  <span class="kw">for</span> dx, dy <span class="kw">in</span> ORTHO:
    nx, ny = x+dx, y+dy
    <span class="kw">if</span> <span class="num">0</span>&lt;=nx&lt;W <span class="kw">and</span> <span class="num">0</span>&lt;=ny&lt;H:
      total += grid[ny][nx] - grid[y][x]
  <span class="kw">return</span> total / len(ORTHO)
<span class="cm"># å…¨æ–¹å‘ã€å¯¾è§’æ–¹å‘ã‚‚åˆ¥é–¢æ•°ãŒå¿…è¦
# â†’ 3é–¢æ•° Ã— å„10è¡Œ = 30è¡Œä»¥ä¸Š</span>`,
    reiLines:10, otherLines:35,
    quiz:'|>âŸ¨orthoâŸ© ãŒé¸æŠã™ã‚‹neighborã¯ï¼Ÿ',
    options:['NE,SE,SW,NW','N,E,S,W','N,NE,E,SE','å…¨8æ–¹å‘'],
    answer:1,
    explain:'orthoï¼ˆç›´äº¤ï¼‰ã¯ N, E, S, W ã®4æ–¹å‘ã§ã™ã€‚diagï¼ˆå¯¾è§’ï¼‰ã¯ NE, SE, SW, NW ã§ã™ã€‚*ï¼ˆã‚¢ã‚¹ã‚¿ãƒªã‚¹ã‚¯ï¼‰ã¯å…¨8æ–¹å‘ã‚’é¸æŠã—ã¾ã™ã€‚'
  },

  // ===== Category: Dimensional Slice =====
  {
    id:6, category:'pipe', difficulty:2,
    title:'Dimensional Slice â€” æ¬¡å…ƒã‚¹ãƒ©ã‚¤ã‚¹',
    tags:['pipe','center'],
    desc:`[dim:æ–¹å‘] ã¯å¤šæ¬¡å…ƒæ•°ã®ç‰¹å®šæ¬¡å…ƒã ã‘ã‚’å–ã‚Šå‡ºã™è¨˜æ³•ã§ã™ã€‚
æ–¹å‘æŒ‡å®šãƒ‘ã‚¤ãƒ—ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€éƒ¨åˆ†è¨ˆç®—ã‚’ç°¡æ½”ã«è¨˜è¿°ã§ãã¾ã™ã€‚`,
    descJp:'å¤šæ¬¡å…ƒæ•°ã®ã€Œæ–¹å‘åã«ã‚ˆã‚‹éƒ¨åˆ†å‚ç…§ã€ã¯Reiç†è«–ã¨ä¸å¯åˆ†ã§ã™ã€‚',
    reiCode:`<span class="kw">let</span> md = <span class="fn">ğ•„</span>{<span class="num">5</span>; <span class="num">1,2,3,4,5,6,7,8</span>}

<span class="cm">// æ¬¡å…ƒã‚¹ãƒ©ã‚¤ã‚¹</span>
md<span class="op">[dim:N]</span>               <span class="cm">// â†’ 1</span>
md<span class="op">[dim:N,S]</span>             <span class="cm">// â†’ [1, 5]</span>
md<span class="op">[dim:diag]</span>            <span class="cm">// â†’ [2, 4, 6, 8]</span>
md<span class="op">[dim:ortho]</span>           <span class="cm">// â†’ [1, 3, 5, 7]</span>

<span class="cm">// ã‚¹ãƒ©ã‚¤ã‚¹ + ãƒ‘ã‚¤ãƒ—</span>
md<span class="op">[dim:diag]</span> |&gt; <span class="fn">sum</span>    <span class="cm">// â†’ 20</span>
md<span class="op">[dim:ortho]</span> |&gt; <span class="fn">mean</span>  <span class="cm">// â†’ 4.0</span>

<span class="cm">// å‹•çš„ã‚¹ãƒ©ã‚¤ã‚¹</span>
<span class="kw">let</span> dirs = [N, NE, E]
md<span class="op">[dim:dirs]</span> |&gt; <span class="fn">weighted_mean</span>`,
    otherLabel:'NumPy',
    otherCode:`<span class="cm"># NumPy: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã§æ‰‹å‹•æŒ‡å®š</span>
neighbors = [<span class="num">1,2,3,4,5,6,7,8</span>]
diag_idx = [<span class="num">1,3,5,7</span>]  <span class="cm"># NE,SE,SW,NW</span>
ortho_idx = [<span class="num">0,2,4,6</span>] <span class="cm"># N,E,S,W</span>

diag_sum = sum(neighbors[i] <span class="kw">for</span> i <span class="kw">in</span> diag_idx)
ortho_mean = np.mean([neighbors[i]
                      <span class="kw">for</span> i <span class="kw">in</span> ortho_idx])

<span class="cm"># æ–¹å‘åãŒãªã„ â†’ ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼</span>
<span class="cm"># å¯èª­æ€§ãƒ»ä¿å®ˆæ€§ã«é›£ã‚ã‚Š</span>`,
    reiLines:8, otherLines:20,
    quiz:'ğ•„{5; 1,2,3,4,5,6,7,8}[dim:ortho] |> sum ã®çµæœã¯ï¼Ÿ',
    options:['10','16','20','36'],
    answer:1,
    explain:'ortho ã¯ N(1), E(3), S(5), W(7) ã®4æ–¹å‘ã§ã™ã€‚1+3+5+7 = 16ã€‚neighbor indexã¯ N=0, NE=1, E=2, SE=3, S=4, SW=5, W=6, NW=7 ã§ã™ã€‚'
  },

  // ===== Category: Center-Neighbor =====
  {
    id:7, category:'center', difficulty:1,
    title:'Center-Neighbor Primitive â€” 4Ã— ã‚³ãƒ¼ãƒ‰çŸ­ç¸®',
    tags:['center','compress'],
    desc:`Reiã®center-neighborãƒ‘ã‚¿ãƒ¼ãƒ³ã¯è¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã™ã€‚
ç”»åƒã‚«ãƒ¼ãƒãƒ«è¨ˆç®—ã‚’ä¾‹ã«ã€å¾“æ¥32è¡Œã®ã‚³ãƒ¼ãƒ‰ãŒ8è¡Œã«çŸ­ç¸®ã•ã‚Œã‚‹å®Ÿè¨¼æ¸ˆã¿ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ç¤ºã—ã¾ã™ã€‚`,
    descJp:'74%ã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›ã¯ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¨¼æ¸ˆã¿ã§ã™ã€‚',
    reiCode:`<span class="cm">// Rei: ç”»åƒã‚«ãƒ¼ãƒãƒ«è¨ˆç®—ï¼ˆ8è¡Œï¼‰</span>
<span class="kw">compress</span> <span class="fn">kernel3x3</span>(grid, weights) =
  grid |&gt; <span class="fn">map_cells</span>(cell =&gt;
    <span class="fn">ğ•„</span>{cell.center; cell.neighbors}
      |&gt; <span class="fn">weighted_sum</span>(weights)
      |&gt; <span class="fn">clamp</span>(<span class="num">0</span>, <span class="num">255</span>)
  )

<span class="cm">// ä½¿ç”¨ä¾‹: ã¼ã‹ã—</span>
image |&gt; <span class="fn">kernel3x3</span>([<span class="num">1,1,1,1,1,1,1,1</span>])`,
    otherLabel:'Python + NumPy',
    otherCode:`<span class="cm"># Python: åŒç­‰å‡¦ç†ï¼ˆ32è¡Œï¼‰</span>
<span class="kw">def</span> <span class="fn">kernel3x3</span>(grid, weights):
  h, w = len(grid), len(grid[<span class="num">0</span>])
  result = [[<span class="num">0</span>]*w <span class="kw">for</span> _ <span class="kw">in</span> range(h)]
  offsets = [
    (<span class="num">-1,-1</span>),(<span class="num">-1,0</span>),(<span class="num">-1,1</span>),
    (<span class="num">0,-1</span>),         (<span class="num">0,1</span>),
    (<span class="num">1,-1</span>), (<span class="num">1,0</span>), (<span class="num">1,1</span>)
  ]
  <span class="kw">for</span> y <span class="kw">in</span> range(h):
    <span class="kw">for</span> x <span class="kw">in</span> range(w):
      total = <span class="num">0</span>
      <span class="kw">for</span> i,(dy,dx) <span class="kw">in</span> enumerate(offsets):
        ny, nx = y+dy, x+dx
        <span class="kw">if</span> <span class="num">0</span>&lt;=ny&lt;h <span class="kw">and</span> <span class="num">0</span>&lt;=nx&lt;w:
          total += grid[ny][nx] * weights[i]
      result[y][x] = max(<span class="num">0</span>,min(<span class="num">255</span>,total))
  <span class="kw">return</span> result`,
    reiLines:8, otherLines:32,
    quiz:'Reiã®center-neighborãŒè¨€èªãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã‚ã‚‹ã“ã¨ã®åˆ©ç‚¹ã¯ï¼Ÿ',
    options:['ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ãŒè‰¯ã„','ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒä¸¦åˆ—æœ€é©åŒ–ã§ãã‚‹','ã‚¨ãƒ©ãƒ¼ãŒå°‘ãªã„','å…¨ã¦æ­£ã—ã„'],
    answer:3,
    explain:'center-neighborãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¨€èªãƒ¬ãƒ™ãƒ«ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ã§ã‚ã‚‹ã“ã¨ã§ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãŒè‡ªå‹•ä¸¦åˆ—åŒ–ã§ãã€ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆãŒæ¶ˆãˆã¦ã‚¨ãƒ©ãƒ¼ãŒæ¸›ã‚Šã€ãƒ¡ãƒ¢ãƒªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æœ€é©åŒ–ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚'
  },

  // ===== Category: Compression =====
  {
    id:8, category:'compress', difficulty:2,
    title:'Compression Level â€” æ®µéšçš„åœ§ç¸®',
    tags:['compress'],
    desc:`compressâ°ã€œcompressâˆ ã¯åœ§ç¸®ã®ã€Œæ·±ã•ã€ã‚’æŒ‡å®šã—ã¾ã™ã€‚
ãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ã»ã©è¤‡é›‘ãªå¤‰æ›ã‚’ç¤ºã—ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã®æœ€é©åŒ–ãƒ’ãƒ³ãƒˆã¨ãªã‚Šã¾ã™ã€‚`,
    descJp:'ã€Œåœ§ç¸®ã¯å“²å­¦ã§ã‚ã‚‹ã€ã¨ã„ã†D-FUMTã®æ€æƒ³ã‚’è¨˜æ³•ãƒ¬ãƒ™ãƒ«ã§è¡¨ç¾ã—ã¾ã™ã€‚',
    reiCode:`<span class="cm">// åœ§ç¸®ãƒ¬ãƒ™ãƒ«æŒ‡å®š</span>
<span class="kw">compressâ°</span> <span class="fn">identity</span>(x) = x              <span class="cm">// L0: æ’ç­‰</span>
<span class="kw">compressÂ¹</span> <span class="fn">double</span>(x) = x * <span class="num">2</span>            <span class="cm">// L1: å˜ç´”å¤‰æ›</span>
<span class="kw">compressÂ²</span> <span class="fn">conv</span>(g, k) = g <span class="op">|&gt;âŸ¨*âŸ©</span> k       <span class="cm">// L2: ãƒ‘ã‚¿ãƒ¼ãƒ³</span>
<span class="kw">compressÂ³</span> <span class="fn">pipeline</span>(s) = s               <span class="cm">// L3: å¤šæ®µå¤‰æ›</span>
  |&gt; <span class="fn">normalize</span> |&gt; <span class="fn">transform</span> |&gt; <span class="fn">classify</span>
<span class="kw">compressâˆ</span> <span class="fn">genesis</span>(âˆ…) = â„•               <span class="cm">// Lâˆ: ä¸å¯é€†</span>

<span class="cm">// è‡ªå‹•æ¨è«–</span>
<span class="kw">compress auto</span> <span class="fn">fn</span>(x) = x |&gt; <span class="fn">a</span> |&gt; <span class="fn">b</span>
fn.compression_level   <span class="cm">// â†’ 2</span>`,
    otherLabel:'ä»–è¨€èª',
    otherCode:`<span class="cm">// ä»–è¨€èª: é–¢æ•°ã®ã€Œåœ§ç¸®ãƒ¬ãƒ™ãƒ«ã€ã¨ã„ã†
// æ¦‚å¿µè‡ªä½“ãŒå­˜åœ¨ã—ãªã„</span>

<span class="cm">// æœ€ã‚‚è¿‘ã„æ¦‚å¿µã¯ Haskell ã®å‹ã‚¯ãƒ©ã‚¹ã ãŒ
// ã€Œå¤‰æ›ã®è¤‡é›‘ã•ã€ã‚’å‹ã§è¡¨ç¾ã™ã‚‹æ‰‹æ®µã¯ãªã„</span>

<span class="kw">def</span> <span class="fn">identity</span>(x): <span class="kw">return</span> x
<span class="kw">def</span> <span class="fn">double</span>(x): <span class="kw">return</span> x * <span class="num">2</span>
<span class="cm"># ã“ã‚Œã‚‰ã®ã€Œåœ§ç¸®ãƒ¬ãƒ™ãƒ«ã®é•ã„ã€ã‚’
# å‹ã‚·ã‚¹ãƒ†ãƒ ã§åŒºåˆ¥ã™ã‚‹æ–¹æ³•ãŒãªã„</span>`,
    reiLines:9, otherLines:15,
    quiz:'compressâˆ ãŒæ„å‘³ã™ã‚‹ã®ã¯ï¼Ÿ',
    options:['ç„¡é™ãƒ«ãƒ¼ãƒ—','ä¸å¯é€†å¤‰æ›ï¼ˆgenesisç­‰ï¼‰','æœ€å¤§é€Ÿåº¦','ã‚¨ãƒ©ãƒ¼'],
    answer:1,
    explain:'compressâˆ ã¯ä¸å¯é€†å¤‰æ›ã‚’ç¤ºã—ã¾ã™ã€‚genesisï¼ˆâˆ…â†’â„•ï¼‰ã®ã‚ˆã†ã«å…ƒã«æˆ»ã›ãªã„å¤‰æ›ã‚’æ„å‘³ã—ã€ISLã®ä¸å¯é€†æ€§ã¨ç›´çµã—ã¦ã„ã¾ã™ã€‚'
  },

  // ===== Category: Witnessed Assignment =====
  {
    id:9, category:'witness', difficulty:2,
    title:'Witnessed Assignment â€” è¨¼äººä»˜ãä»£å…¥',
    tags:['witness','phase'],
    desc:`witnessed by ã¯å¤‰æ•°ä»£å…¥ã«è¨¼æ‹ ï¼ˆwitnessï¼‰ã‚’ä»˜ä¸ã—ã¾ã™ã€‚
ISLã®æš—å·å­¦çš„è¨¼äººã‚·ã‚¹ãƒ†ãƒ ã‚’é€šå¸¸ã®ã‚³ãƒ¼ãƒ‰ã«ä¸€èˆ¬åŒ–ã—ãŸã€Reiç‹¬è‡ªã®è¨˜æ³•ã§ã™ã€‚`,
    descJp:'ã€Œä»£å…¥ã«è¨¼æ‹ ã‚’ä»˜ã‘ã‚‹ã€ã¨ã„ã†æ¦‚å¿µè‡ªä½“ãŒReiã®ç™ºæ˜ã§ã™ã€‚',
    reiCode:`<span class="cm">// è¨¼äººä»˜ãä»£å…¥</span>
<span class="kw">let</span> raw = <span class="fn">loadGrid</span>(<span class="str">"sensor.csv"</span>)
  <span class="kw">witnessed by</span> <span class="str">"source:sensor_v3"</span>

<span class="cm">// å¤‰æ›ãƒã‚§ãƒ¼ãƒ³ã®è¨¼è·¡è¿½è·¡</span>
<span class="kw">let</span> result = raw
  |&gt; <span class="fn">filter</span> <span class="kw">witnessed by</span> <span class="str">"step1:filter"</span>
  |&gt; <span class="fn">normalize</span> <span class="kw">witnessed by</span> <span class="str">"step2:norm"</span>
  |&gt; <span class="fn">classify</span> <span class="kw">witnessed by</span> <span class="str">"step3:class"</span>

<span class="cm">// è¨¼äººãƒã‚§ãƒ¼ãƒ³å‚ç…§</span>
result.witnesses
<span class="cm">// â†’ ["source:sensor_v3","step1:filter",</span>
<span class="cm">//    "step2:norm","step3:class"]</span>

result.witness_hash
<span class="cm">// â†’ "a3f8c1d2" (FNV-1a)</span>`,
    otherLabel:'å¾“æ¥ã®ãƒ­ã‚°',
    otherCode:`<span class="cm">// å¾“æ¥: ãƒ­ã‚°ã¯å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã—</span>
logger.info(<span class="str">"Loading sensor.csv"</span>)
raw = loadGrid(<span class="str">"sensor.csv"</span>)
logger.info(<span class="str">"Filtering..."</span>)
result = <span class="fn">filter</span>(raw)
logger.info(<span class="str">"Normalizing..."</span>)
result = <span class="fn">normalize</span>(result)
<span class="cm">// ãƒ­ã‚°ã¨å€¤ãŒåˆ†é›¢ â†’ æ”¹ã–ã‚“å¯èƒ½
// ãƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹æ•´åˆæ€§æ¤œè¨¼ãªã—
// å€¤ã®æ¥æ­´ã‚’å‹å®‰å…¨ã«è¿½è·¡ã§ããªã„</span>`,
    reiLines:10, otherLines:18,
    quiz:'witnessed by ã¨å¾“æ¥ãƒ­ã‚°ã®æ ¹æœ¬çš„ãªé•ã„ã¯ï¼Ÿ',
    options:['å‡ºåŠ›å…ˆãŒé•ã†','å€¤ã¨è¨¼æ‹ ãŒå‹ãƒ¬ãƒ™ãƒ«ã§çµåˆã—ã¦ã„ã‚‹','ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé•ã†','æ–‡æ³•ãŒé•ã†ã ã‘'],
    answer:1,
    explain:'witnessed by ã¯å€¤ã®æ¥æ­´ã‚’å€¤è‡ªèº«ã®å±æ€§ã¨ã—ã¦å‹ãƒ¬ãƒ™ãƒ«ã§è¿½è·¡ã—ã¾ã™ã€‚å¾“æ¥ã®ãƒ­ã‚°ã¯å€¤ã¨åˆ†é›¢ã—ã¦ã„ã‚‹ãŸã‚æ”¹ã–ã‚“å¯èƒ½ã§ã™ãŒã€Reiã®è¨¼äººãƒã‚§ãƒ¼ãƒ³ã¯FNV-1aãƒãƒƒã‚·ãƒ¥ã§æš—å·å­¦çš„ã«ä¿è­·ã•ã‚Œã¾ã™ã€‚'
  },

  // ===== Category: Zero Extension =====
  {
    id:10, category:'genesis', difficulty:2,
    title:'Zero Extension Chain â€” é›¶ç‚¹æ‹¡å¼µãƒã‚§ãƒ¼ãƒ³',
    tags:['genesis'],
    desc:`0â†’oâ†’oâ†’x ã¯é›¶ç‚¹æ‹¡å¼µã®å…¨éç¨‹ã‚’ä¸€ã¤ã®å¼ã§è¨˜è¿°ã—ã¾ã™ã€‚
åˆ†å²ãƒã‚§ãƒ¼ãƒ³ï¼ˆ0â†’oâ†’{x,z}ï¼‰ã§åŒæ™‚å¤šæ–¹å‘æ‹¡å¼µã‚‚å¯èƒ½ã§ã™ã€‚`,
    descJp:'D-FUMTã®æ¬¡å…ƒç†è«–ã¨ä¸å¯åˆ†ãªè¨˜æ³•ã§ã€ç†è«–ãªã—ã«ã¯æ¨¡å€£ä¸èƒ½ã§ã™ã€‚',
    reiCode:`<span class="cm">// ãƒã‚§ãƒ¼ãƒ³è¨˜æ³•ã§é›¶ç‚¹æ‹¡å¼µ</span>
<span class="kw">let</span> ext = <span class="num">0</span><span class="op">â†’</span>o<span class="op">â†’</span>o<span class="op">â†’</span>o<span class="op">â†’</span>x    <span class="cm">// 0ooox</span>

<span class="cm">// å¾“æ¥ã®é€æ¬¡æ‹¡å¼µ</span>
<span class="kw">let</span> a = <span class="num">0</span>o
<span class="kw">let</span> b = a &gt;&gt; :o           <span class="cm">// 0oo</span>
<span class="kw">let</span> c = b &gt;&gt; :o           <span class="cm">// 0ooo</span>
<span class="kw">let</span> d = c &gt;&gt; :x           <span class="cm">// 0ooox</span>

<span class="cm">// åˆ†å²ãƒã‚§ãƒ¼ãƒ³ï¼ˆåŒæ™‚å¤šæ–¹å‘æ‹¡å¼µï¼‰</span>
<span class="kw">let</span> branches = <span class="num">0</span><span class="op">â†’</span>o<span class="op">â†’</span>{x, z}
<span class="cm">// â†’ [0oox, 0ooz] ã‚’åŒæ™‚ç”Ÿæˆ</span>

<span class="cm">// ç¸®ç´„ãƒã‚§ãƒ¼ãƒ³</span>
<span class="kw">let</span> reduced = <span class="num">0</span>ooox<span class="op">â†â†</span>      <span class="cm">// 0ooï¼ˆ2å›ç¸®ç´„ï¼‰</span>

<span class="cm">// ãƒ‘ã‚¤ãƒ—æ¥ç¶š</span>
<span class="num">0</span><span class="op">â†’</span>o<span class="op">â†’</span>o<span class="op">â†’</span>x |&gt; <span class="fn">compute</span> |&gt; <span class="fn">seal</span>`,
    otherLabel:'å¾“æ¥æ‰‹æ³•',
    otherCode:`<span class="cm">// å¾“æ¥: æ‹¡å¼µæ“ä½œã®ãƒã‚§ãƒ¼ãƒ³ã¨ã„ã†
// æ¦‚å¿µè‡ªä½“ãŒå­˜åœ¨ã—ãªã„</span>

<span class="cm">// æœ€ã‚‚è¿‘ã„æ¯”å–©: ãƒ“ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³</span>
<span class="kw">new</span> ExtendedNumber(<span class="num">0</span>)
  .extend(<span class="str">'o'</span>)
  .extend(<span class="str">'o'</span>)
  .extend(<span class="str">'o'</span>)
  .extend(<span class="str">'x'</span>)
  .build()

<span class="cm">// åˆ†å²ã¯æ‰‹å‹•ãƒ«ãƒ¼ãƒ—</span>
branches = [<span class="str">'x'</span>,<span class="str">'z'</span>].map(c =&gt;
  base.extend(c).build()
)`,
    reiLines:8, otherLines:20,
    quiz:'0â†’oâ†’{x, z} ãŒç”Ÿæˆã™ã‚‹ã®ã¯ï¼Ÿ',
    options:['0oxzï¼ˆ1ã¤ï¼‰','[0oox, 0ooz]ï¼ˆ2ã¤ï¼‰','ã‚¨ãƒ©ãƒ¼','0oï¼ˆ1ã¤ï¼‰'],
    answer:1,
    explain:'åˆ†å²ãƒã‚§ãƒ¼ãƒ³ â†’{x, z} ã¯åŸºåº• 0o ã‹ã‚‰ xæ–¹å‘ã¨ zæ–¹å‘ã«åŒæ™‚æ‹¡å¼µã—ã€0oox ã¨ 0ooz ã®2ã¤ã®æ‹¡å¼µæ•°ã‚’åŒæ™‚ã«ç”Ÿæˆã—ã¾ã™ã€‚'
  },

  // ===== Category: Multi-Dimensional Curvature =====
  {
    id:11, category:'kappa', difficulty:3,
    title:'Multi-Dim Curvature + Directional Conv â€” ç·åˆå•é¡Œ',
    tags:['kappa','pipe','center'],
    desc:`å¤šæ¬¡å…ƒæ•°ã®å„æ¬¡å…ƒã«ç‹¬ç«‹ã—ãŸæ›²ç‡ã‚’ä»˜ä¸ã—ã€æ–¹å‘æŒ‡å®šãƒ‘ã‚¤ãƒ—ã§ç•³ã¿è¾¼ã¿ã¾ã™ã€‚
æ›²ç‡ãŒé«˜ã„æ¬¡å…ƒã»ã©çµæœã«å¼·ã„å½±éŸ¿ã‚’ä¸ãˆã¾ã™ï¼ˆcurvature-weighted convolutionï¼‰ã€‚`,
    descJp:'Îº Ã— æ–¹å‘æŒ‡å®š Ã— center-neighbor ã®3æ¦‚å¿µã‚’çµ±åˆã—ãŸã€Reiã®çœŸä¾¡ã‚’ç¤ºã™å•é¡Œã§ã™ã€‚',
    reiCode:`<span class="cm">// å„æ¬¡å…ƒã«ç‹¬ç«‹ã—ãŸÎº</span>
<span class="kw">let</span> cell = <span class="fn">ğ•„</span>{<span class="num">5</span><span class="ka">Îº0.3</span>; <span class="num">1</span><span class="ka">Îº0.1</span>, <span class="num">2</span><span class="ka">Îº0.8</span>,
              <span class="num">3</span><span class="ka">Îº0.2</span>, <span class="num">4</span><span class="ka">Îº0.9</span>}

<span class="cm">// é«˜æ›²ç‡æ–¹å‘ã®ã¿ã§ç•³ã¿è¾¼ã¿</span>
cell <span class="op">|&gt;âŸ¨*âŸ©</span> <span class="fn">curvature_conv</span>
<span class="cm">// â†’ é«˜Îºã®neighborã»ã©å½±éŸ¿å¤§</span>

<span class="cm">// æ›²ç‡ã§æ–¹å‘ã‚’å‹•çš„é¸æŠ</span>
<span class="kw">let</span> hot = cell.neighbors
  |&gt; <span class="fn">filter</span>(n =&gt; n<span class="op">.Îº</span> &gt; <span class="num">0.5</span>)
<span class="cm">// â†’ [2Îº0.8, 4Îº0.9]ï¼ˆé«˜æ›²ç‡ã®ã¿ï¼‰</span>

<span class="cm">// æœ€å¤§æ›²ç‡ã®æ¬¡å…ƒã‚’ç‰¹å®š</span>
cell |&gt; <span class="fn">max_Îº_neighbor</span>
<span class="cm">// â†’ 4Îº0.9ï¼ˆç›¸è»¢ç§»ã«æœ€ã‚‚è¿‘ã„æ¬¡å…ƒï¼‰</span>`,
    otherLabel:'Python',
    otherCode:`<span class="cm"># Python: æ•°å€¤ã¨æ›²ç‡ã‚’åˆ¥ç®¡ç†</span>
values = [<span class="num">1, 2, 3, 4</span>]
kappas = [<span class="num">0.1, 0.8, 0.2, 0.9</span>]
center_val, center_k = <span class="num">5</span>, <span class="num">0.3</span>

<span class="cm"># æ›²ç‡é‡ã¿ä»˜ãç•³ã¿è¾¼ã¿</span>
total_w = sum(<span class="num">1</span>+k <span class="kw">for</span> k <span class="kw">in</span> kappas)
result = sum(v*(<span class="num">1</span>+k)
  <span class="kw">for</span> v,k <span class="kw">in</span> zip(values,kappas)) / total_w

<span class="cm"># é«˜æ›²ç‡ãƒ•ã‚£ãƒ«ã‚¿</span>
hot = [(v,k) <span class="kw">for</span> v,k <span class="kw">in</span>
  zip(values,kappas) <span class="kw">if</span> k &gt; <span class="num">0.5</span>]

<span class="cm"># å€¤ã¨æ›²ç‡ãŒåˆ†é›¢ â†’ ãƒã‚°ã®æ¸©åºŠ
# Reiã§ã¯ä¸å¯åˆ†ã®1ãƒªãƒ†ãƒ©ãƒ«</span>`,
    reiLines:10, otherLines:22,
    quiz:'ğ•„{5Îº0.3; 1Îº0.1, 2Îº0.8, 3Îº0.2, 4Îº0.9} ã§ç›¸è»¢ç§»ã«æœ€ã‚‚è¿‘ã„æ¬¡å…ƒã¯ï¼Ÿ',
    options:['center(5Îº0.3)','neighbor 2(2Îº0.8)','neighbor 4(4Îº0.9)','neighbor 1(1Îº0.1)'],
    answer:2,
    explain:'4Îº0.9 ãŒæœ€å¤§æ›²ç‡ã§ã™ã€‚Îº=0.9 ã¯é–¾å€¤ 0.7 ã‚’è¶…ãˆã¦ã„ã‚‹ãŸã‚ã€ã“ã®æ¬¡å…ƒã¯æ—¢ã«ç›¸è»¢ç§»æ¡ä»¶ã‚’æº€ãŸã—ã¦ã„ã¾ã™ã€‚'
  },

  // ===== Category: Full Integration =====
  {
    id:12, category:'integration', difficulty:3,
    title:'Full Rei Pipeline â€” å…¨è¨˜æ³•çµ±åˆ',
    tags:['phase','kappa','pipe','witness','compress'],
    desc:`Phase Guard + Curvature Literal + Directional Pipe + Witnessed Assignment + Compression Level
ã®å…¨ã¦ã‚’1ã¤ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§çµ±åˆã—ã¾ã™ã€‚ã“ã‚ŒãŒReiã®çœŸã®å§¿ã§ã™ã€‚`,
    descJp:'6ã¤ã®ç‹¬è‡ªè¨˜æ³•ã‚’åŒæ™‚ã«ä½¿ã†å•é¡Œã¯ã€ä»–è¨€èªã§ã¯åŸç†çš„ã«è¨˜è¿°ä¸å¯èƒ½ã§ã™ã€‚',
    reiCode:`<span class="cm">// å…¨è¨˜æ³•çµ±åˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³</span>
<span class="kw">compressÂ³</span> <span class="fn">full_pipeline</span>(
  data: MultiDim <span class="ph">@ Open</span>
) -&gt; MultiDim <span class="ph">@ Compacted</span> =

  data
    <span class="kw">witnessed by</span> <span class="str">"input"</span>

    <span class="cm">// æ–¹å‘æŒ‡å®šç•³ã¿è¾¼ã¿</span>
    <span class="op">|&gt;âŸ¨orthoâŸ©</span> <span class="fn">gradient</span>
    <span class="kw">witnessed by</span> <span class="str">"gradient:ortho"</span>

    <span class="cm">// æ›²ç‡ãƒ•ã‚£ãƒ«ã‚¿</span>
    |&gt; <span class="fn">filter</span>(cell =&gt; cell<span class="op">.Îº</span> &gt; <span class="num">0.3</span>)
    <span class="kw">witnessed by</span> <span class="str">"filter:high_Îº"</span>

    <span class="cm">// å°å° (Open â†’ Sealed)</span>
    |&gt; <span class="fn">commit</span>
    <span class="kw">witnessed by</span> <span class="str">"sealed"</span>

    <span class="cm">// åœ§ç¸® (Sealed â†’ Compacted)</span>
    |&gt; <span class="fn">compact</span>
    <span class="kw">witnessed by</span> <span class="str">"final_proof"</span>`,
    otherLabel:'ä¸å¯èƒ½',
    otherCode:`<span class="cm">// ã“ã®å•é¡Œã¯ä»–è¨€èªã§ã¯è¨˜è¿°ä¸å¯èƒ½ã§ã™ã€‚</span>
<span class="cm">//</span>
<span class="cm">// å¿…è¦ãªè¨€èªæ©Ÿèƒ½:</span>
<span class="cm">//   â‘  ç›¸ã‚¬ãƒ¼ãƒ‰ (@ Phase)       â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//   â‘¡ æ›²ç‡ãƒªãƒ†ãƒ©ãƒ« (Îº)         â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//   â‘¢ æ–¹å‘æŒ‡å®šãƒ‘ã‚¤ãƒ— (|&gt;âŸ¨âŸ©)   â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//   â‘£ è¨¼äººä»˜ãä»£å…¥             â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//   â‘¤ æ®µéšçš„åœ§ç¸®               â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//   â‘¥ center-neighbor          â†’ å­˜åœ¨ã—ãªã„</span>
<span class="cm">//</span>
<span class="cm">// 6ã¤å…¨ã¦ã‚’å‚™ãˆã‚‹è¨€èªã¯</span>
<span class="cm">// Rei (0â‚€å¼) ã ã‘ã§ã™ã€‚</span>`,
    reiLines:16, otherLines:0,
    quiz:'ã“ã®ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ç›¸é·ç§»ã¯ä½•å›ç™ºç”Ÿã™ã‚‹ï¼Ÿ',
    options:['0å›','1å›','2å›','3å›'],
    answer:2,
    explain:'Open â†’ Sealedï¼ˆcommitæ™‚ï¼‰ã¨ Sealed â†’ Compactedï¼ˆcompactæ™‚ï¼‰ã®2å›ã§ã™ã€‚ç›¸ã‚¬ãƒ¼ãƒ‰ã«ã‚ˆã‚Šã€ã“ã®é †åºã¯æ–‡æ³•ãƒ¬ãƒ™ãƒ«ã§å¼·åˆ¶ã•ã‚Œã¾ã™ã€‚'
  },
];

// ============================================================
// Render Engine
// ============================================================

let solved = new Set();
let score = 0;
const CATEGORIES = {
  all:{label:'å…¨å•é¡Œ',icon:''},
  phase:{label:'@ Phase',icon:''},
  kappa:{label:'Îºæ›²ç‡',icon:''},
  pipe:{label:'æ–¹å‘ãƒ‘ã‚¤ãƒ—',icon:''},
  center:{label:'ä¸­å¿ƒ-è¿‘å‚',icon:''},
  compress:{label:'åœ§ç¸®',icon:''},
  witness:{label:'è¨¼äºº',icon:''},
  genesis:{label:'Genesis',icon:''},
  integration:{label:'çµ±åˆ',icon:''},
};

function renderNav(){
  const nav=document.getElementById('nav');
  nav.innerHTML='';
  Object.entries(CATEGORIES).forEach(([k,v])=>{
    const count=k==='all'?PROBLEMS.length:PROBLEMS.filter(p=>p.category===k).length;
    if(k!=='all'&&count===0)return;
    const b=document.createElement('button');
    b.textContent=v.label;
    b.innerHTML+=`<span class="count">${count}</span>`;
    b.className=k==='all'?'active':'';
    b.onclick=()=>{
      nav.querySelectorAll('button').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      renderProblems(k);
    };
    nav.appendChild(b);
  });
}

function renderProblems(cat='all'){
  const c=document.getElementById('problems');
  c.innerHTML='';
  const filtered=cat==='all'?PROBLEMS:PROBLEMS.filter(p=>p.category===cat);
  filtered.forEach(p=>{
    const el=document.createElement('div');
    el.className=`problem${solved.has(p.id)?' solved':''}`;
    el.id=`p${p.id}`;
    el.innerHTML=`
      <div class="p-header" onclick="toggleProblem(${p.id})">
        <span class="p-number">${String(p.id).padStart(2,'0')}</span>
        <span class="p-title">${p.title}</span>
        <span class="p-tags">${p.tags.map(t=>`<span class="p-tag ${t}">${t}</span>`).join('')}</span>
        <span class="p-diff d${p.difficulty}">${['','â˜…','â˜…â˜…','â˜…â˜…â˜…'][p.difficulty]}</span>
        <span class="p-toggle" id="tog${p.id}">â–¸</span>
      </div>
      <div class="p-body" id="body${p.id}">
        <div class="p-desc">${p.desc}<div class="jp">${p.descJp}</div></div>
        ${renderComparison(p)}
        ${renderLinesMetric(p)}
        ${renderQuiz(p)}
      </div>
    `;
    c.appendChild(el);
  });
}

function renderComparison(p){
  return `<div class="comparison">
    <div>
      <div class="col-header rei-col">Rei (0â‚€å¼)</div>
      <div class="code-block"><div class="code-label rei">Rei</div><pre><code>${p.reiCode}</code></pre></div>
    </div>
    <div>
      <div class="col-header">${p.otherLabel}</div>
      <div class="code-block"><div class="code-label other">${p.otherLabel}</div><pre><code>${p.otherCode}</code></pre></div>
    </div>
  </div>`;
}

function renderLinesMetric(p){
  if(!p.otherLines)return '';
  const ratio = p.reiLines / p.otherLines;
  const reduction = Math.round((1-ratio)*100);
  const maxLines = Math.max(p.reiLines, p.otherLines);
  return `<div class="lines-metric">
    <div class="lines-label" style="color:var(--gold)">Rei</div>
    <div class="lines-bar"><div class="lines-bar-fill rei" style="width:${(p.reiLines/maxLines)*100}%"></div></div>
    <div class="lines-count" style="color:var(--gold)">${p.reiLines}è¡Œ</div>
  </div>
  <div class="lines-metric">
    <div class="lines-label" style="color:var(--blue)">${p.otherLabel.split(' ')[0]}</div>
    <div class="lines-bar"><div class="lines-bar-fill other" style="width:${(p.otherLines/maxLines)*100}%"></div></div>
    <div class="lines-count" style="color:var(--blue)">${p.otherLines}è¡Œ</div>
  </div>
  <div style="text-align:center;font-size:0.8em;color:var(--gold-dim);margin:4px 0 8px">
    ${reduction}% ã‚³ãƒ¼ãƒ‰å‰Šæ¸› (${(p.otherLines/p.reiLines).toFixed(1)}Ã— çŸ­ç¸®)
  </div>`;
}

function renderQuiz(p){
  return `<div class="quiz" id="quiz${p.id}">
    <div class="quiz-q">Q: ${p.quiz}</div>
    <div class="quiz-options">
      ${p.options.map((o,i)=>`<div class="quiz-opt" id="opt${p.id}_${i}" onclick="answer(${p.id},${i})">${String.fromCharCode(65+i)}. ${o}</div>`).join('')}
    </div>
    <div class="quiz-explain" id="exp${p.id}">${p.explain}</div>
  </div>`;
}

function toggleProblem(id){
  const body=document.getElementById(`body${id}`);
  const tog=document.getElementById(`tog${id}`);
  body.classList.toggle('open');
  tog.classList.toggle('open');
}

function answer(pid,idx){
  const p=PROBLEMS.find(x=>x.id===pid);
  if(solved.has(pid))return;
  
  const opts=document.querySelectorAll(`#quiz${pid} .quiz-opt`);
  opts.forEach((o,i)=>{
    o.classList.add('disabled');
    if(i===p.answer) o.classList.add('correct');
    else if(i===idx) o.classList.add('incorrect');
  });
  
  document.getElementById(`exp${pid}`).classList.add('show');
  solved.add(pid);
  if(idx===p.answer) score++;
  
  document.getElementById('score').textContent=score;
  document.getElementById('solved').textContent=solved.size;
  document.getElementById(`p${pid}`).classList.add('solved');
}

// Init
renderNav();
renderProblems();
</script>
</body>
</html>
