# Rei MCP Server ðŸ”®

**Reiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå°‚ç”¨ã®Model Context Protocol (MCP)ã‚µãƒ¼ãƒãƒ¼**

> ã€Œ1TBã‚’500kbã«åœ§ç¸®ã€ã™ã‚‹ã®ã§ã¯ãªãã€
> ã€Œ1TBã®ç´¢å¼•ã‹ã‚‰ä»Šå¿…è¦ãª500kbã ã‘ã‚’å–ã‚Šå‡ºã™ã€
> â€” å›³æ›¸é¤¨ã®å¸æ›¸ã®å½¹å‰²

## ãªãœå¿…è¦ã‹

LLMã«ã¯**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦**ã¨ã„ã†åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒå·¨å¤§ã«ãªã‚‹ã¨ã€
å…¨ã‚³ãƒ¼ãƒ‰ã‚’ä¸€åº¦ã«LLMã«æ¸¡ã™ã“ã¨ã¯ç‰©ç†çš„ã«ä¸å¯èƒ½ã§ã™ã€‚

ã“ã®MCPã‚µãƒ¼ãƒãƒ¼ã¯ã€LLMãŒè‡ªåˆ†ã§ã€Œå¿…è¦ãªã‚³ãƒ¼ãƒ‰ã ã‘ã€ã‚’æ¤œç´¢ãƒ»å–å¾—ã§ãã‚‹ä»•çµ„ã¿ã‚’æä¾›ã—ã¾ã™ã€‚

```
[Claude] â†MCPâ†’ [Rei Project Server]
  ã€Œãƒ‘ã‚ºãƒ«ã® propagateStep ã‚’è¦‹ã›ã¦ã€
     â†’ puzzle.ts ã® L355-480 ã ã‘è¿”ã™
  ã€Œã“ã®é–¢æ•°ã®å‘¼ã³å‡ºã—å…ƒã¯ï¼Ÿã€  
     â†’ pipe-puzzle.ts ã® L45 ã‚’è¿”ã™
```

## æä¾›ã™ã‚‹6ã¤ã®ãƒ„ãƒ¼ãƒ«

| ãƒ„ãƒ¼ãƒ« | èª¬æ˜Ž | ä¾‹ |
|--------|------|-----|
| `search_symbol` | ã‚·ãƒ³ãƒœãƒ«åã§æ¤œç´¢ | `query: "Evaluator"` |
| `get_code` | ãƒ•ã‚¡ã‚¤ãƒ«ã®ç‰¹å®šè¡Œã‚’å–å¾— | `file: "puzzle.ts", start: 100, end: 200` |
| `find_callers` | å‘¼ã³å‡ºã—å…ƒã‚’æ¤œç´¢ | `symbol: "propagateStep"` |
| `grep` | å…¨æ–‡ãƒ†ã‚­ã‚¹ãƒˆæ¤œç´¢ | `pattern: "bind\\("` |
| `get_file` | ãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’å–å¾— | `file: "lexer.ts"` |
| `project_summary` | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“åƒ | (å¼•æ•°ãªã—) |

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Reiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§:
cd rei-lang

# rei-mcp-serverãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«é…ç½®
# (GitHubã®rei-langãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ã—ã¦)
mkdir -p tools/mcp-server
# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå¾Œè¿°ã®é…ç½®æ‰‹é †ã‚’å‚ç…§ï¼‰

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd tools/mcp-server
npm install

# ãƒ“ãƒ«ãƒ‰
npm run build
```

### 2. Claude Desktop ã§ä½¿ã†å ´åˆ

Claude Desktop ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚

**Windows:**
`%APPDATA%\Claude\claude_desktop_config.json`

**macOS:**
`~/Library/Application Support/Claude/claude_desktop_config.json`

ä»¥ä¸‹ã®å†…å®¹ã‚’è¿½åŠ :

```json
{
  "mcpServers": {
    "rei-project": {
      "command": "node",
      "args": ["C:\\Users\\user\\projects\\rei-lang\\tools\\mcp-server\\dist\\index.js"],
      "env": {
        "REI_PROJECT_ROOT": "C:\\Users\\user\\projects\\rei-lang"
      }
    }
  }
}
```

> âš ï¸ ãƒ‘ã‚¹ã¯ã”è‡ªèº«ã®ç’°å¢ƒã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„

### 3. Claude Code ã§ä½¿ã†å ´åˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã® .mcp.json ã«è¿½åŠ 
cat > .mcp.json << 'EOF'
{
  "mcpServers": {
    "rei-project": {
      "command": "node",
      "args": ["./tools/mcp-server/dist/index.js"],
      "env": {
        "REI_PROJECT_ROOT": "."
      }
    }
  }
}
EOF
```

### 4. å‹•ä½œç¢ºèª

Claude Desktopã‚’å†èµ·å‹•ã—ãŸå¾Œã€ä»¥ä¸‹ã®ã‚ˆã†ã«è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„:

```
ã€ŒReiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒã‚’æ•™ãˆã¦ã€
â†’ project_summary ãƒ„ãƒ¼ãƒ«ãŒå‘¼ã°ã‚Œã€ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãƒ»ã‚·ãƒ³ãƒœãƒ«ä¸€è¦§ãƒ»ä¾å­˜é–¢ä¿‚ãŒè¿”ã‚‹

ã€Œevaluateã¨ã„ã†é–¢æ•°ã¯ã©ã“ã«ã‚ã‚‹ï¼Ÿã€
â†’ search_symbol ãƒ„ãƒ¼ãƒ«ãŒå‘¼ã°ã‚Œã€è©²å½“ç®‡æ‰€ãŒè¿”ã‚‹

ã€Œpuzzle.tsã®100-200è¡Œç›®ã‚’è¦‹ã›ã¦ã€
â†’ get_code ãƒ„ãƒ¼ãƒ«ãŒå‘¼ã°ã‚Œã€è©²å½“ã‚³ãƒ¼ãƒ‰ãŒè¿”ã‚‹
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
tools/mcp-server/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts      â† MCPã‚µãƒ¼ãƒãƒ¼æœ¬ä½“ï¼ˆãƒ„ãƒ¼ãƒ«ãƒ»ãƒªã‚½ãƒ¼ã‚¹å®šç¾©ï¼‰
â”‚   â””â”€â”€ indexer.ts     â† ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¤ãƒ³ãƒ‡ã‚¯ã‚µãƒ¼ï¼ˆã‚³ãƒ¼ãƒ‰è§£æžï¼‰
â””â”€â”€ dist/              â† ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
    â”œâ”€â”€ index.js
    â””â”€â”€ indexer.js
```

## D-FUMTã®6å±žæ€§ã¨ã®å¯¾å¿œ

| MCPã‚µãƒ¼ãƒãƒ¼ã®æ©Ÿèƒ½ | D-FUMTã®å±žæ€§ |
|-------------------|-------------|
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç´¢å¼•ï¼ˆæ§‹é€ ï¼‰ | **å ´**ï¼ˆfieldï¼‰â€” ã‚³ãƒ¼ãƒ‰ã®ç©ºé–“çš„é…ç½® |
| search_symbolï¼ˆæŽ¢ç´¢ï¼‰ | **æµã‚Œ**ï¼ˆflowï¼‰â€” æƒ…å ±ã®æ¤œç´¢ãƒ•ãƒ­ãƒ¼ |
| find_callersï¼ˆä¾å­˜è¿½è·¡ï¼‰ | **é–¢ä¿‚**ï¼ˆrelationï¼‰â€” ã‚·ãƒ³ãƒœãƒ«é–“ã®çµåˆ |
| get_codeï¼ˆè¡Œç¯„å›²å–å¾—ï¼‰ | **å±¤**ï¼ˆlayerï¼‰â€” å¿…è¦ãªæ·±åº¦ã ã‘å–å¾— |
| project_summaryï¼ˆè¨˜éŒ²ï¼‰ | **è¨˜æ†¶**ï¼ˆmemoryï¼‰â€” ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®è¨˜æ†¶ |
| LLMã®è‡ªå‹•ãƒ„ãƒ¼ãƒ«é¸æŠž | **æ„å¿—**ï¼ˆwillï¼‰â€” ä½•ã‚’å–å¾—ã™ã‚‹ã‹ã®åˆ¤æ–­ |

## ä»Šå¾Œã®æ‹¡å¼µï¼ˆç¬¬3æ®µéšŽ: Reiã®è‡ªå·±è¨˜è¿°æ€§ï¼‰

å°†æ¥çš„ã«ã¯ã€Reiã®ã‚³ãƒ¼ãƒ‰è‡ªä½“ã‚’Reiã®ð•„æ§‹é€ ã¨ã—ã¦è¨˜è¿°ã—ã€
Reiè‡ªèº«ãŒã€Œã“ã®å¤‰æ›´ã¯ä½•ã«å½±éŸ¿ã™ã‚‹ã‹ã€ã‚’è¨ˆç®—ã§ãã‚‹çŠ¶æ…‹ã‚’ç›®æŒ‡ã—ã¾ã™:

```rei
// ReiãŒè‡ªåˆ†è‡ªèº«ã‚’ç†è§£ã™ã‚‹
rei_project |> sigma
// â†’ { center: "evaluator-core", periphery: ["pipe-puzzle", "pipe-game", ...] }

rei_project |> diffuse("what depends on puzzle.ts?")
// â†’ pipe-puzzle.ts, evaluator-core.ts, puzzle.test.ts
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT â€” Nobuki Fujimoto (è—¤æœ¬ä¼¸æ¨¹)
